
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../04-iam-secrets/">
      
      
        <link rel="next" href="../06-apps-service/">
      
      
        
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>Automation and IaC - Paul Leone – Projects & Portfolio</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../stylesheets/image-overrides.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#automation-and-infrastructure-as-code-iac" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="Paul Leone – Projects &amp; Portfolio" class="md-header__button md-logo" aria-label="Paul Leone – Projects & Portfolio" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 1 3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5zm0 4a3 3 0 0 1 3 3 3 3 0 0 1-3 3 3 3 0 0 1-3-3 3 3 0 0 1 3-3m5.13 12A9.7 9.7 0 0 1 12 20.92 9.7 9.7 0 0 1 6.87 17c-.34-.5-.63-1-.87-1.53 0-1.65 2.71-3 6-3s6 1.32 6 3c-.24.53-.53 1.03-.87 1.53"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Paul Leone – Projects & Portfolio
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Automation and IaC
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



  

<nav class="md-nav md-nav--primary md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Paul Leone – Projects &amp; Portfolio" class="md-nav__button md-logo" aria-label="Paul Leone – Projects & Portfolio" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 1 3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5zm0 4a3 3 0 0 1 3 3 3 3 0 0 1-3 3 3 3 0 0 1-3-3 3 3 0 0 1 3-3m5.13 12A9.7 9.7 0 0 1 12 20.92 9.7 9.7 0 0 1 6.87 17c-.34-.5-.63-1-.87-1.53 0-1.65 2.71-3 6-3s6 1.32 6 3c-.24.53-.53 1.03-.87 1.53"/></svg>

    </a>
    Paul Leone – Projects & Portfolio
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Home
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Projects
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Projects
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../business-intelligence/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Business Intelligence & Data Analytics
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../threat-intel/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Threat Intelligence Brief & SOC Improvement Plan
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3" checked>
        
          
          <label class="md-nav__link" for="__nav_2_3" id="__nav_2_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Security Homelab
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Security Homelab
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Overview/Landing Page
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../01-exec-summary/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Executive Summary/Posture
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../02-platform/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Platform and Virtualization
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../03-network/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Network Security and Remote Access
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../04-iam-secrets/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Identity, Access and Secrets
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    Automation and IaC
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    Automation and IaC
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-automation-and-infrastructure-as-code-iac" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. Automation and Infrastructure as Code (IaC)
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1. Automation and Infrastructure as Code (IaC)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#architecture-overview" class="md-nav__link">
    <span class="md-ellipsis">
      
        Architecture Overview
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#architecture-principles-alignment" class="md-nav__link">
    <span class="md-ellipsis">
      
        Architecture Principles Alignment
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#strategic-value" class="md-nav__link">
    <span class="md-ellipsis">
      
        Strategic Value
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-infrastructure-provisioning-with-terraform" class="md-nav__link">
    <span class="md-ellipsis">
      
        2. Infrastructure Provisioning with Terraform
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2. Infrastructure Provisioning with Terraform">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#architecture-overview_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        Architecture Overview
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deployment-architecture" class="md-nav__link">
    <span class="md-ellipsis">
      
        Deployment Architecture
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#authentication-authorization" class="md-nav__link">
    <span class="md-ellipsis">
      
        Authentication &amp; Authorization
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#security-controls" class="md-nav__link">
    <span class="md-ellipsis">
      
        Security Controls
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#terraform-configuration-deep-dive" class="md-nav__link">
    <span class="md-ellipsis">
      
        Terraform Configuration Deep Dive
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Terraform Configuration Deep Dive">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#lxc-container-provisioning-maintf" class="md-nav__link">
    <span class="md-ellipsis">
      
        LXC Container Provisioning (main.tf)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vm-provisioning-maintf-qemu" class="md-nav__link">
    <span class="md-ellipsis">
      
        VM Provisioning (main.tf - QEMU)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#terraform-plan-output" class="md-nav__link">
    <span class="md-ellipsis">
      
        Terraform Plan Output
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#terraform-workflow" class="md-nav__link">
    <span class="md-ellipsis">
      
        Terraform Workflow
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#state-management-strategy" class="md-nav__link">
    <span class="md-ellipsis">
      
        State Management Strategy
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-configuration-management-with-ansible" class="md-nav__link">
    <span class="md-ellipsis">
      
        3. Configuration Management with Ansible
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3. Configuration Management with Ansible">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#31-architecture-overview" class="md-nav__link">
    <span class="md-ellipsis">
      
        3.1 Architecture Overview
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#32-setup-overview" class="md-nav__link">
    <span class="md-ellipsis">
      
        3.2 Setup Overview
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#control-plane-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      
        Control Plane Configuration
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ssh-key-architecture" class="md-nav__link">
    <span class="md-ellipsis">
      
        SSH Key Architecture
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ansible-user-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      
        Ansible User Configuration
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#33-playbook-architecture" class="md-nav__link">
    <span class="md-ellipsis">
      
        3.3 Playbook Architecture
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3.3 Playbook Architecture">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bootstrap-playbook-new_installyaml" class="md-nav__link">
    <span class="md-ellipsis">
      
        Bootstrap Playbook (new_install.yaml)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#additional-playbooks" class="md-nav__link">
    <span class="md-ellipsis">
      
        Additional Playbooks
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-version-control-and-gitops" class="md-nav__link">
    <span class="md-ellipsis">
      
        4. Version Control and GitOps
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4. Version Control and GitOps">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#version-control-strategy" class="md-nav__link">
    <span class="md-ellipsis">
      
        Version Control Strategy
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-workflow-automation-with-n8n" class="md-nav__link">
    <span class="md-ellipsis">
      
        5. Workflow Automation with n8n
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="5. Workflow Automation with n8n">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#51-platform-overview" class="md-nav__link">
    <span class="md-ellipsis">
      
        5.1 Platform Overview
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#n8n-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      
        n8n Configuration
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#security-controls_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        Security Controls
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lab-use-cases" class="md-nav__link">
    <span class="md-ellipsis">
      
        Lab Use Cases
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#52-workflow-1-ansible-playbook-automation" class="md-nav__link">
    <span class="md-ellipsis">
      
        5.2 Workflow 1: Ansible Playbook Automation
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#workflow-nodes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Workflow Nodes
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#json-output-example" class="md-nav__link">
    <span class="md-ellipsis">
      
        JSON Output Example
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#play-audit-system-info-task-gathering-facts-ok-webhomecom-ok-1921681136-ok-unboundhomecom-ok-bindhomecom-ok-1921681250-ok-uptimekhomecom-ok-19216814-ok-stepcahomecom-ok-trfkhomecom-ok-wazuhhomecom-ok-192168193-ok-19216810015-ok-1921681246-ok-192168133-ok-19216826-ok-1921682008-ok-1921682007-ok-1921681126-ok-1921681109-ok-1921681166-ok-1921681005-task-show-disk-usage-ok-webhomecom-disk_usagestdout_lines-filesystem-size-used-avail-use-mounted-on-devloop0-16g-12g-32g-79-none-492k-40k-488k-1-dev-efivarfs-192k-180k-76k-96-sysfirmwareefiefivars-tmpfs-47g-0-47g-0-devshm-tmpfs-19g-156k-19g-1-run-tmpfs-50m-0-50m-0-runlock-tmpfs-47g-124k-47g-1-tmp-tmpfs-94g-80k-94g-1-runuser0-tmpfs-94g-80k-94g-1-runuser1001-task-show-ip-address-info-ok-webhomecom-ip_infostdout_lines-1-lo-loopbackuplower_up-mtu-65536-qdisc-noqueue-state-unknown-group-default-qlen-1000-linkloopback-000000000000-brd-000000000000-inet-1270018-scope-host-lo-valid_lft-forever-preferred_lft-forever-inet6-1128-scope-host-noprefixroute-valid_lft-forever-preferred_lft-forever-2-eth0if76-broadcastmulticastuplower_up-mtu-1500-qdisc-noqueue-state-up-group-default-qlen-1000-linkether-bc2411f9a08c-brd-ffffffffffff-link-netnsid-0-inet-192168110824-brd-1921681255-scope-global-eth0-valid_lft-forever-preferred_lft-forever-inet6-fe80be2411fffef9a08c64-scope-link-proto-kernel_ll-valid_lft-forever-preferred_lft-forever-task-show-routing-table-ok-webhomecom-route_infostdout_lines-default-via-19216811-dev-eth0-proto-static-1921681024-dev-eth0-proto-kernel-scope-link-src-1921681108-task-show-hostname-ok-webhomecom-host_namestdout-apache-ubuntu-task-show-nameservers-ok-webhomecom-resolv_confstdout_lines-begin-pve-search-homecom-nameserver-1921681250-end-pve-task-show-authorized-ssh-keys-ok-webhomecom-msg-ssh-ed25519-rootansible-play-recap-1921681109-ok13-changed5-unreachable0-failed0-skipped0-rescued0-ignored0-1921681126-ok13-changed5-unreachable0-failed0-skipped0-rescued0-ignored0-1921681136-ok13-changed5-unreachable0-failed0-skipped0-rescued0-ignored0-1921681166-ok13-changed5-unreachable0-failed0-skipped0-rescued0-ignored0-1921681246-ok13-changed5-unreachable0-failed0-skipped0-rescued0-ignored0-1921681250-ok13-changed5-unreachable0-failed0-skipped0-rescued0-ignored0-192168133-ok13-changed5-unreachable0-failed0-skipped0-rescued0-ignored0-19216814-ok13-changed5-unreachable0-failed0-skipped0-rescued0-ignored0-192168193-ok13-changed5-unreachable0-failed0-skipped0-rescued0-ignored0-19216810015-ok13-changed5-unreachable0-failed0-skipped0-rescued0-ignored0-1921681005-ok12-changed5-unreachable0-failed0-skipped1-rescued0-ignored1-19216826-ok13-changed5-unreachable0-failed0-skipped0-rescued0-ignored0-1921682007-ok13-changed5-unreachable0-failed0-skipped0-rescued0-ignored0-1921682008-ok13-changed5-unreachable0-failed0-skipped0-rescued0-ignored0-bindhomecom-ok13-changed5-unreachable0-failed0-skipped0-rescued0-ignored0-stepcahomecom-ok13-changed5-unreachable0-failed0-skipped0-rescued0-ignored0-trfkhomecom-ok13-changed5-unreachable0-failed0-skipped0-rescued0-ignored0-unboundhomecom-ok13-changed5-unreachable0-failed0-skipped0-rescued0-ignored0-uptimekhomecom-ok13-changed5-unreachable0-failed0-skipped0-rescued0-ignored0-wazuhhomecom-ok13-changed5-unreachable0-failed0-skipped0-rescued0-ignored0-webhomecom-ok13-changed5-unreachable0-failed0-skipped0-rescued0-ignored0" class="md-nav__link">
    <span class="md-ellipsis">
      
        PLAY [Audit system info] ******************************************************* TASK [Gathering Facts] ********************************************************* ok: [web.home.com] ok: [192.168.1.136] ok: [unbound.home.com] ok: [bind.home.com] ok: [192.168.1.250] ok: [uptimek.home.com] ok: [192.168.1.4] ok: [stepca.home.com] ok: [trfk.home.com] ok: [wazuh.home.com] ok: [192.168.1.93] ok: [192.168.100.15] ok: [192.168.1.246] ok: [192.168.1.33] ok: [192.168.2.6] ok: [192.168.200.8] ok: [192.168.200.7] ok: [192.168.1.126] ok: [192.168.1.109] ok: [192.168.1.166] ok: [192.168.100.5] TASK [Show disk usage] ********************************************************* ok: [web.home.com] =&gt; { &quot;disk_usage.stdout_lines&quot;: [ &quot;Filesystem Size Used Avail Use% Mounted on&quot;, &quot;/dev/loop0 16G 12G 3.2G 79% /&quot;, &quot;none 492K 4.0K 488K 1% /dev&quot;, &quot;efivarfs 192K 180K 7.6K 96% /sys/firmware/efi/efivars&quot;, &quot;tmpfs 47G 0 47G 0% /dev/shm&quot;, &quot;tmpfs 19G 156K 19G 1% /run&quot;, &quot;tmpfs 5.0M 0 5.0M 0% /run/lock&quot;, &quot;tmpfs 47G 124K 47G 1% /tmp&quot;, &quot;tmpfs 9.4G 8.0K 9.4G 1% /run/user/0&quot;, &quot;tmpfs 9.4G 8.0K 9.4G 1% /run/user/1001&quot; ] } TASK [Show IP address info] **************************************************** ok: [web.home.com] =&gt; { &quot;ip_info.stdout_lines&quot;: [ &quot;1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000&quot;, &quot; link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00&quot;, &quot; inet 127.0.0.1/8 scope host lo&quot;, &quot; valid_lft forever preferred_lft forever&quot;, &quot; inet6 ::1/128 scope host noprefixroute &quot;, &quot; valid_lft forever preferred_lft forever&quot;, &quot;2: eth0@if76: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default qlen 1000&quot;, &quot; link/ether bc:24:11:f9:a0:8c brd ff:ff:ff:ff:ff:ff link-netnsid 0&quot;, &quot; inet 192.168.1.108/24 brd 192.168.1.255 scope global eth0&quot;, &quot; valid_lft forever preferred_lft forever&quot;, &quot; inet6 fe80::be24:11ff:fef9:a08c/64 scope link proto kernel_ll &quot;, &quot; valid_lft forever preferred_lft forever&quot; ] } TASK [Show routing table] ****************************************************** ok: [web.home.com] =&gt; { &quot;route_info.stdout_lines&quot;: [ &quot;default via 192.168.1.1 dev eth0 proto static &quot;, &quot;192.168.1.0/24 dev eth0 proto kernel scope link src 192.168.1.108 &quot; ] } TASK [Show hostname] *********************************************************** ok: [web.home.com] =&gt; { &quot;host_name.stdout&quot;: &quot;apache-ubuntu&quot; } TASK [Show nameservers] ******************************************************** ok: [web.home.com] =&gt; { &quot;resolv_conf.stdout_lines&quot;: [ &quot;# --- BEGIN PVE ---&quot;, &quot;search home.com&quot;, &quot;nameserver 192.168.1.250&quot;, &quot;# --- END PVE ---&quot; ] } TASK [Show authorized SSH keys] ************************************************ ok: [web.home.com] =&gt; { &quot;msg&quot;: [ &quot;ssh-ed25519 --------- root@ansible&quot;, &quot;&quot; ] } PLAY RECAP ********************************************************************* 192.168.1.109 : ok=13 changed=5 unreachable=0 failed=0 skipped=0 rescued=0 ignored=0 192.168.1.126 : ok=13 changed=5 unreachable=0 failed=0 skipped=0 rescued=0 ignored=0 192.168.1.136 : ok=13 changed=5 unreachable=0 failed=0 skipped=0 rescued=0 ignored=0 192.168.1.166 : ok=13 changed=5 unreachable=0 failed=0 skipped=0 rescued=0 ignored=0 192.168.1.246 : ok=13 changed=5 unreachable=0 failed=0 skipped=0 rescued=0 ignored=0 192.168.1.250 : ok=13 changed=5 unreachable=0 failed=0 skipped=0 rescued=0 ignored=0 192.168.1.33 : ok=13 changed=5 unreachable=0 failed=0 skipped=0 rescued=0 ignored=0 192.168.1.4 : ok=13 changed=5 unreachable=0 failed=0 skipped=0 rescued=0 ignored=0 192.168.1.93 : ok=13 changed=5 unreachable=0 failed=0 skipped=0 rescued=0 ignored=0 192.168.100.15 : ok=13 changed=5 unreachable=0 failed=0 skipped=0 rescued=0 ignored=0 192.168.100.5 : ok=12 changed=5 unreachable=0 failed=0 skipped=1 rescued=0 ignored=1 192.168.2.6 : ok=13 changed=5 unreachable=0 failed=0 skipped=0 rescued=0 ignored=0 192.168.200.7 : ok=13 changed=5 unreachable=0 failed=0 skipped=0 rescued=0 ignored=0 192.168.200.8 : ok=13 changed=5 unreachable=0 failed=0 skipped=0 rescued=0 ignored=0 bind.home.com : ok=13 changed=5 unreachable=0 failed=0 skipped=0 rescued=0 ignored=0 stepca.home.com : ok=13 changed=5 unreachable=0 failed=0 skipped=0 rescued=0 ignored=0 trfk.home.com : ok=13 changed=5 unreachable=0 failed=0 skipped=0 rescued=0 ignored=0 unbound.home.com : ok=13 changed=5 unreachable=0 failed=0 skipped=0 rescued=0 ignored=0 uptimek.home.com : ok=13 changed=5 unreachable=0 failed=0 skipped=0 rescued=0 ignored=0 wazuh.home.com : ok=13 changed=5 unreachable=0 failed=0 skipped=0 rescued=0 ignored=0 web.home.com : ok=13 changed=5 unreachable=0 failed=0 skipped=0 rescued=0 ignored=0
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="PLAY [Audit system info] ******************************************************* TASK [Gathering Facts] ********************************************************* ok: [web.home.com] ok: [192.168.1.136] ok: [unbound.home.com] ok: [bind.home.com] ok: [192.168.1.250] ok: [uptimek.home.com] ok: [192.168.1.4] ok: [stepca.home.com] ok: [trfk.home.com] ok: [wazuh.home.com] ok: [192.168.1.93] ok: [192.168.100.15] ok: [192.168.1.246] ok: [192.168.1.33] ok: [192.168.2.6] ok: [192.168.200.8] ok: [192.168.200.7] ok: [192.168.1.126] ok: [192.168.1.109] ok: [192.168.1.166] ok: [192.168.100.5] TASK [Show disk usage] ********************************************************* ok: [web.home.com] =&gt; { &#34;disk_usage.stdout_lines&#34;: [ &#34;Filesystem Size Used Avail Use% Mounted on&#34;, &#34;/dev/loop0 16G 12G 3.2G 79% /&#34;, &#34;none 492K 4.0K 488K 1% /dev&#34;, &#34;efivarfs 192K 180K 7.6K 96% /sys/firmware/efi/efivars&#34;, &#34;tmpfs 47G 0 47G 0% /dev/shm&#34;, &#34;tmpfs 19G 156K 19G 1% /run&#34;, &#34;tmpfs 5.0M 0 5.0M 0% /run/lock&#34;, &#34;tmpfs 47G 124K 47G 1% /tmp&#34;, &#34;tmpfs 9.4G 8.0K 9.4G 1% /run/user/0&#34;, &#34;tmpfs 9.4G 8.0K 9.4G 1% /run/user/1001&#34; ] } TASK [Show IP address info] **************************************************** ok: [web.home.com] =&gt; { &#34;ip_info.stdout_lines&#34;: [ &#34;1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000&#34;, &#34; link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00&#34;, &#34; inet 127.0.0.1/8 scope host lo&#34;, &#34; valid_lft forever preferred_lft forever&#34;, &#34; inet6 ::1/128 scope host noprefixroute &#34;, &#34; valid_lft forever preferred_lft forever&#34;, &#34;2: eth0@if76: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default qlen 1000&#34;, &#34; link/ether bc:24:11:f9:a0:8c brd ff:ff:ff:ff:ff:ff link-netnsid 0&#34;, &#34; inet 192.168.1.108/24 brd 192.168.1.255 scope global eth0&#34;, &#34; valid_lft forever preferred_lft forever&#34;, &#34; inet6 fe80::be24:11ff:fef9:a08c/64 scope link proto kernel_ll &#34;, &#34; valid_lft forever preferred_lft forever&#34; ] } TASK [Show routing table] ****************************************************** ok: [web.home.com] =&gt; { &#34;route_info.stdout_lines&#34;: [ &#34;default via 192.168.1.1 dev eth0 proto static &#34;, &#34;192.168.1.0/24 dev eth0 proto kernel scope link src 192.168.1.108 &#34; ] } TASK [Show hostname] *********************************************************** ok: [web.home.com] =&gt; { &#34;host_name.stdout&#34;: &#34;apache-ubuntu&#34; } TASK [Show nameservers] ******************************************************** ok: [web.home.com] =&gt; { &#34;resolv_conf.stdout_lines&#34;: [ &#34;# --- BEGIN PVE ---&#34;, &#34;search home.com&#34;, &#34;nameserver 192.168.1.250&#34;, &#34;# --- END PVE ---&#34; ] } TASK [Show authorized SSH keys] ************************************************ ok: [web.home.com] =&gt; { &#34;msg&#34;: [ &#34;ssh-ed25519 --------- root@ansible&#34;, &#34;&#34; ] } PLAY RECAP ********************************************************************* 192.168.1.109 : ok=13 changed=5 unreachable=0 failed=0 skipped=0 rescued=0 ignored=0 192.168.1.126 : ok=13 changed=5 unreachable=0 failed=0 skipped=0 rescued=0 ignored=0 192.168.1.136 : ok=13 changed=5 unreachable=0 failed=0 skipped=0 rescued=0 ignored=0 192.168.1.166 : ok=13 changed=5 unreachable=0 failed=0 skipped=0 rescued=0 ignored=0 192.168.1.246 : ok=13 changed=5 unreachable=0 failed=0 skipped=0 rescued=0 ignored=0 192.168.1.250 : ok=13 changed=5 unreachable=0 failed=0 skipped=0 rescued=0 ignored=0 192.168.1.33 : ok=13 changed=5 unreachable=0 failed=0 skipped=0 rescued=0 ignored=0 192.168.1.4 : ok=13 changed=5 unreachable=0 failed=0 skipped=0 rescued=0 ignored=0 192.168.1.93 : ok=13 changed=5 unreachable=0 failed=0 skipped=0 rescued=0 ignored=0 192.168.100.15 : ok=13 changed=5 unreachable=0 failed=0 skipped=0 rescued=0 ignored=0 192.168.100.5 : ok=12 changed=5 unreachable=0 failed=0 skipped=1 rescued=0 ignored=1 192.168.2.6 : ok=13 changed=5 unreachable=0 failed=0 skipped=0 rescued=0 ignored=0 192.168.200.7 : ok=13 changed=5 unreachable=0 failed=0 skipped=0 rescued=0 ignored=0 192.168.200.8 : ok=13 changed=5 unreachable=0 failed=0 skipped=0 rescued=0 ignored=0 bind.home.com : ok=13 changed=5 unreachable=0 failed=0 skipped=0 rescued=0 ignored=0 stepca.home.com : ok=13 changed=5 unreachable=0 failed=0 skipped=0 rescued=0 ignored=0 trfk.home.com : ok=13 changed=5 unreachable=0 failed=0 skipped=0 rescued=0 ignored=0 unbound.home.com : ok=13 changed=5 unreachable=0 failed=0 skipped=0 rescued=0 ignored=0 uptimek.home.com : ok=13 changed=5 unreachable=0 failed=0 skipped=0 rescued=0 ignored=0 wazuh.home.com : ok=13 changed=5 unreachable=0 failed=0 skipped=0 rescued=0 ignored=0 web.home.com : ok=13 changed=5 unreachable=0 failed=0 skipped=0 rescued=0 ignored=0">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#53-workflow-2-threat-intelligence-aggregation" class="md-nav__link">
    <span class="md-ellipsis">
      
        5.3 Workflow 2: Threat Intelligence Aggregation
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#workflow-nodes_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        Workflow Nodes
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-scripting-for-advanced-automation" class="md-nav__link">
    <span class="md-ellipsis">
      
        6. Scripting for Advanced Automation
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="6. Scripting for Advanced Automation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#script-development-strategy" class="md-nav__link">
    <span class="md-ellipsis">
      
        Script Development Strategy
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#script-language-selection-criteria" class="md-nav__link">
    <span class="md-ellipsis">
      
        Script Language Selection Criteria
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#61-powershell-and-bash-scripting" class="md-nav__link">
    <span class="md-ellipsis">
      
        6.1 PowerShell and Bash Scripting
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="6.1 PowerShell and Bash Scripting">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bash-script-example-backup-automation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Bash Script Example: Backup Automation
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#linux-upgrade-script-overview" class="md-nav__link">
    <span class="md-ellipsis">
      
        Linux Upgrade Script Overview
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#powershell-script-example-windows-update-automation" class="md-nav__link">
    <span class="md-ellipsis">
      
        PowerShell Script Example: Windows Update Automation
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#62-cron-job-scheduling-strategy" class="md-nav__link">
    <span class="md-ellipsis">
      
        6.2 Cron Job Scheduling Strategy
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#63-python-scripting-for-advanced-automation" class="md-nav__link">
    <span class="md-ellipsis">
      
        6.3 Python Scripting for Advanced Automation
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="6.3 Python Scripting for Advanced Automation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#python-script-example-network-scanner" class="md-nav__link">
    <span class="md-ellipsis">
      
        Python Script Example: Network Scanner
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#64-script-integration-and-orchestration" class="md-nav__link">
    <span class="md-ellipsis">
      
        6.4 Script Integration and Orchestration
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#7-automation-security-controls" class="md-nav__link">
    <span class="md-ellipsis">
      
        7. Automation Security Controls
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="7. Automation Security Controls">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#control-framework" class="md-nav__link">
    <span class="md-ellipsis">
      
        Control Framework
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#authentication-authorization_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        Authentication &amp; Authorization
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#secrets-protection" class="md-nav__link">
    <span class="md-ellipsis">
      
        Secrets Protection
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#audit-trail-components" class="md-nav__link">
    <span class="md-ellipsis">
      
        Audit Trail Components
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#9-practical-use-cases-and-workflows" class="md-nav__link">
    <span class="md-ellipsis">
      
        9. Practical Use Cases and Workflows
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="9. Practical Use Cases and Workflows">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#scenario-1-new-vm-provisioning" class="md-nav__link">
    <span class="md-ellipsis">
      
        Scenario 1: New VM Provisioning
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scenario-2-weekly-security-update-cycle" class="md-nav__link">
    <span class="md-ellipsis">
      
        Scenario 2: Weekly Security Update Cycle
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scenario-3-rapid-disaster-recovery" class="md-nav__link">
    <span class="md-ellipsis">
      
        Scenario 3: Rapid Disaster Recovery
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scenario-4-threat-intelligence-distribution" class="md-nav__link">
    <span class="md-ellipsis">
      
        Scenario 4: Threat Intelligence Distribution
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scenario-5-configuration-drift-detection" class="md-nav__link">
    <span class="md-ellipsis">
      
        Scenario 5: Configuration Drift Detection
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#11-security-homelab-section-links" class="md-nav__link">
    <span class="md-ellipsis">
      
        11. Security Homelab Section Links
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../06-apps-service/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Applications and Services
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../07-vis-response-pt1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Observability and Response, part 1
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../08-vis-response-pt2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Observability and Response, part 2
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_3_10" >
        
          
          <label class="md-nav__link" for="__nav_2_3_10" id="__nav_2_3_10_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    GRC Frameworks
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_3_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3_10">
            <span class="md-nav__icon md-icon"></span>
            
  
    GRC Frameworks
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../grc/grc-index/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    GRC Overview/Landing Page
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../grc/01-summary/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    GRC Summary
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../grc/grc-nist-csf/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    NIST CSF
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../grc/grc-nist-800/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    NIST SP 800-53
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../grc/grc-cis-controls/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    CIS Controls
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../grc/grc-iso27001/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ISO 27001
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../grc/grc-mitre/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    MITRE ATT&CK
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../grc/owasp/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    OWASP 2025
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../grc/zero-trust.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    CISA & NIST Zero Trust
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="automation-and-infrastructure-as-code-iac">Automation and Infrastructure as Code (IaC)<a class="headerlink" href="#automation-and-infrastructure-as-code-iac" title="Permanent link">&para;</a></h1>
<p><strong>Document Control:</strong> <br />
Version: 1.0<br />
Last Updated: January 30, 2026<br />
Owner: Paul Leone </p>
<hr />
<h2 id="1-automation-and-infrastructure-as-code-iac">1. Automation and Infrastructure as Code (IaC)<a class="headerlink" href="#1-automation-and-infrastructure-as-code-iac" title="Permanent link">&para;</a></h2>
<h3 id="architecture-overview">Architecture Overview<a class="headerlink" href="#architecture-overview" title="Permanent link">&para;</a></h3>
<p>The lab implements a comprehensive automation strategy using infrastructure as code principles, configuration management, and workflow orchestration. This approach provides repeatable deployments, consistent configurations, and automated operations across the entire infrastructure stack.</p>
<p><strong>Security Impact</strong></p>
<ul>
<li>Configuration drift eliminated through code‑driven enforcement</li>
<li>Human error reduced via automated validation</li>
<li>Credential exposure prevented through integrated secret management</li>
<li>Unauthorized changes blocked through Git‑based approval workflows</li>
<li>Disaster recovery enabled through fully reproducible infrastructure</li>
<li>Audit compliance maintained via immutable version history</li>
</ul>
<p><strong>Deployment Rationale:</strong> Infrastructure as Code eliminates manual configuration drift, reduces human error, and enables rapid disaster recovery. The automation stack transforms a complex 40+ host lab environment into a reproducible, documented system that can be rebuilt from code within hours instead of weeks. This mirrors enterprise DevOps practices and demonstrates proficiency with industry-standard automation tools (Terraform, Ansible, CI/CD pipelines). Enterprise environments leverage IaC to manage hundreds or thousands of servers with consistent security baselines—manual approaches become impossible at scale. This implementation demonstrates understanding of GitOps principles where infrastructure state is declared in version control, changes are peer-reviewed via pull requests, and deployments are automated through CI/CD pipelines.</p>
<h3 id="architecture-principles-alignment">Architecture Principles Alignment<a class="headerlink" href="#architecture-principles-alignment" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>Defense in Depth:</strong> Infrastructure changes peer-reviewed before deployment; Terraform plan reviewed for security impact; Ansible playbooks enforce CIS Benchmarks; automated testing validates security controls before production</li>
<li><strong>Secure by Design:</strong> Least-privilege service accounts for automation tools; secrets stored in Ansible Vault/Vaultwarden; SSH keys rotated via automated playbooks; no hardcoded credentials in version control</li>
<li><strong>Zero Trust:</strong> Every infrastructure change logged to Git with committer identity; Terraform state files encrypted; API tokens short-lived and rotated; automation execution audited via SIEM</li>
</ul>
<h3 id="strategic-value">Strategic Value<a class="headerlink" href="#strategic-value" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>Reduced provisioning time:</strong> VM deployment from 30 minutes (manual) to &lt;5 minutes (Terraform automation)</li>
<li><strong>Configuration consistency:</strong> Ansible ensures identical baselines across all hosts (100% CIS Benchmark compliance)</li>
<li><strong>Audit trail:</strong> Git commits provide full history of infrastructure changes (who, what, when, why)</li>
<li><strong>Disaster recovery:</strong> Entire lab can be rebuilt from GitHub repository (&lt;2 hours full recovery)</li>
<li><strong>Learning platform:</strong> Hands-on experience with tools used in production environments (transferable to enterprise roles)</li>
<li><strong>Compliance automation:</strong> Security controls codified and version-controlled (auditable evidence of control implementation)</li>
</ul>
<hr />
<h2 id="2-infrastructure-provisioning-with-terraform">2. Infrastructure Provisioning with Terraform<a class="headerlink" href="#2-infrastructure-provisioning-with-terraform" title="Permanent link">&para;</a></h2>
<h3 id="architecture-overview_1">Architecture Overview<a class="headerlink" href="#architecture-overview_1" title="Permanent link">&para;</a></h3>
<p>Terraform manages the complete lifecycle of Proxmox virtual machines and LXC containers using declarative configuration files. The infrastructure is defined as code, version-controlled, and applied through a dedicated automation controller VM running Ubuntu Server.</p>
<p><strong>Security Impact</strong></p>
<ul>
<li>Least‑privilege automation enforced through Proxmox API tokens</li>
<li>Infrastructure changes tracked and auditable via Git commit history</li>
<li>Unauthorized modifications prevented through Terraform's stateful resource management</li>
<li>Disaster recovery enabled through declarative rebuilds directly from code</li>
<li>Credential exposure eliminated through encrypted Terraform variables</li>
<li>Change validation performed prior to execution using terraform plan</li>
</ul>
<p><strong>Deployment Rationale:</strong> Manual VM creation is time-consuming, error-prone, and undocumented—scaling to 40+ VMs/containers requires automation. Terraform demonstrates infrastructure-as-code where VM specifications (CPU, RAM, storage, network) are declared in HCL configuration files, version-controlled, and applied idempotently. This mirrors enterprise infrastructure management (AWS CloudFormation, Azure Resource Manager) where infrastructure is treated as software with code review, testing, and CI/CD deployment. The approach enables rapid environment replication (dev/staging/production), consistent resource configurations, and automated disaster recovery.</p>
<p><strong>Architecture Principles Alignment</strong></p>
<ul>
<li><strong>Defense in Depth:</strong> Terraform state stored remotely with access controls; API tokens scoped to minimal permissions; plan review catches misconfigurations before apply; resource tagging enables compliance auditing</li>
<li><strong>Secure by Design:</strong> Proxmox API tokens instead of passwords; Terraform variables encrypted; no secrets in Git repositories; automated validation via pre-commit hooks</li>
<li><strong>Zero Trust:</strong> Every Terraform execution logged; state file modifications tracked; API calls authenticated via tokens; infrastructure changes require explicit approval</li>
</ul>
<h3 id="deployment-architecture">Deployment Architecture<a class="headerlink" href="#deployment-architecture" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Component</th>
<th>Technology</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td>Terraform Controller</td>
<td>CentOS LXC (192.168.x.x)</td>
<td>Isolated automation host</td>
</tr>
<tr>
<td>Terraform Version</td>
<td>v1.6.x</td>
<td>Infrastructure provisioning engine</td>
</tr>
<tr>
<td>Provider</td>
<td>Telmate/proxmox v2.9.x</td>
<td>Proxmox VE API integration</td>
</tr>
<tr>
<td>State Backend</td>
<td>Local file, Cloudflare R2</td>
<td>State persistence and locking</td>
</tr>
<tr>
<td>Secrets Management</td>
<td>terraform.tfvars (gitignored)</td>
<td>API tokens and credentials</td>
</tr>
</tbody>
</table>
<h3 id="authentication-authorization">Authentication &amp; Authorization<a class="headerlink" href="#authentication-authorization" title="Permanent link">&para;</a></h3>
<p><strong>Proxmox Service Account:</strong></p>
<ul>
<li>Username: terraform@pve</li>
<li>Authentication: API token (non-password, scoped)</li>
<li>Token ID: terraform-token</li>
<li>Permission Group: TerraformProvisioners</li>
<li>Granted Privileges:</li>
<li>VM.Allocate (create VMs)</li>
<li>VM.Config.* (modify VM settings)</li>
<li>VM.PowerMgmt (start/stop/shutdown)</li>
<li>Datastore.AllocateSpace (provision storage)</li>
<li>SDN.Use (network assignment)</li>
<li>Principle: Least privilege - cannot modify Proxmox cluster config or other users</li>
</ul>
<h3 id="security-controls">Security Controls<a class="headerlink" href="#security-controls" title="Permanent link">&para;</a></h3>
<ul>
<li>Secrets management: Proxmox API token stored in env variable</li>
<li>State File Protection: Contains sensitive data, stored with restrictive permissions (0600)</li>
<li>TLS Verification: pm_tls_insecure = false enforces valid certificate checks</li>
<li>Separate Workspaces: VM and LXC builds isolated to prevent cross-contamination</li>
<li>Gitignore Enforcement: terraform.tfvars, *.tfstate excluded from version control</li>
</ul>
<p><strong>Diagram Placeholder: Terraform Project Structure Screenshots (2 images)</strong></p>
<p><strong>Project Structure:</strong>
<div class="highlight"><pre><span></span><code>terraform/
├── vm/
│   ├── main.tf              # VM resource definitions
│   ├── variables.tf         # Input variable declarations
│   ├── terraform.tfvars     # Sensitive values (gitignored)
│   ├── outputs.tf           # Return values (IP, VMID)
│   └── .terraform.lock.hcl  # Provider version lock
├── lxc/
│   ├── main.tf              # LXC resource definitions
│   ├── variables.tf         # Input variable declarations
│   ├── terraform.tfvars     # Sensitive values (gitignored)
│   └── outputs.tf           # Return values
└── modules/
    └── common/              # Reusable module components
</code></pre></div></p>
<h3 id="terraform-configuration-deep-dive">Terraform Configuration Deep Dive<a class="headerlink" href="#terraform-configuration-deep-dive" title="Permanent link">&para;</a></h3>
<h4 id="lxc-container-provisioning-maintf">LXC Container Provisioning (main.tf)<a class="headerlink" href="#lxc-container-provisioning-maintf" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="kc">terraf</span><span class="err">orm</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="err">required_providers</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="err">proxmox</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="err">source</span><span class="w">  </span><span class="err">=</span><span class="w"> </span><span class="s2">&quot;Terraform-for-Proxmox/proxmox&quot;</span>

<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
<span class="err">variable</span><span class="w"> </span><span class="s2">&quot;pm_api_token_id&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="err">descrip</span><span class="kc">t</span><span class="err">io</span><span class="kc">n</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="s2">&quot;Proxmox API token ID&quot;</span>
<span class="w">  </span><span class="kc">t</span><span class="err">ype</span><span class="w">        </span><span class="err">=</span><span class="w"> </span><span class="err">s</span><span class="kc">tr</span><span class="err">i</span><span class="kc">n</span><span class="err">g</span>
<span class="p">}</span>

<span class="err">variable</span><span class="w"> </span><span class="s2">&quot;pm_api_token_secret&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="err">descrip</span><span class="kc">t</span><span class="err">io</span><span class="kc">n</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="s2">&quot;Proxmox API token secret&quot;</span>
<span class="w">  </span><span class="kc">t</span><span class="err">ype</span><span class="w">        </span><span class="err">=</span><span class="w"> </span><span class="err">s</span><span class="kc">tr</span><span class="err">i</span><span class="kc">n</span><span class="err">g</span>
<span class="w">  </span><span class="err">se</span><span class="kc">ns</span><span class="err">i</span><span class="kc">t</span><span class="err">ive</span><span class="w">   </span><span class="err">=</span><span class="w"> </span><span class="kc">true</span>
<span class="p">}</span>
<span class="err">variable</span><span class="w"> </span><span class="s2">&quot;rootpassword&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="err">descrip</span><span class="kc">t</span><span class="err">io</span><span class="kc">n</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="s2">&quot;Cloud-init password for this VM&quot;</span>
<span class="w">  </span><span class="kc">t</span><span class="err">ype</span><span class="w">        </span><span class="err">=</span><span class="w"> </span><span class="err">s</span><span class="kc">tr</span><span class="err">i</span><span class="kc">n</span><span class="err">g</span>
<span class="w">  </span><span class="err">se</span><span class="kc">ns</span><span class="err">i</span><span class="kc">t</span><span class="err">ive</span><span class="w">   </span><span class="err">=</span><span class="w"> </span><span class="kc">true</span>
<span class="p">}</span>
<span class="err">variable</span><span class="w"> </span><span class="s2">&quot;lxc_name&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="err">descrip</span><span class="kc">t</span><span class="err">io</span><span class="kc">n</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="s2">&quot;Hostname of the LXC container&quot;</span>
<span class="w">  </span><span class="kc">t</span><span class="err">ype</span><span class="w">        </span><span class="err">=</span><span class="w"> </span><span class="err">s</span><span class="kc">tr</span><span class="err">i</span><span class="kc">n</span><span class="err">g</span>
<span class="w">  </span><span class="err">de</span><span class="kc">fault</span><span class="w">     </span><span class="err">=</span><span class="w"> </span><span class="s2">&quot;debian-lxc&quot;</span>

<span class="p">}</span>

<span class="err">variable</span><span class="w"> </span><span class="s2">&quot;lxc_id&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="err">descrip</span><span class="kc">t</span><span class="err">io</span><span class="kc">n</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="s2">&quot;VMID for the LXC container&quot;</span>
<span class="w">  </span><span class="kc">t</span><span class="err">ype</span><span class="w">        </span><span class="err">=</span><span class="w"> </span><span class="kc">nu</span><span class="err">mber</span>
<span class="p">}</span>


<span class="err">provider</span><span class="w"> </span><span class="s2">&quot;proxmox&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="err">pm_api_url</span><span class="w">          </span><span class="err">=</span><span class="w"> </span><span class="s2">&quot;https://pve.home.com:8006/api2/json&quot;</span>
<span class="w">    </span><span class="err">pm_api_</span><span class="kc">t</span><span class="err">oke</span><span class="kc">n</span><span class="err">_id</span><span class="w">     </span><span class="err">=</span><span class="w"> </span><span class="err">var.pm_api_</span><span class="kc">t</span><span class="err">oke</span><span class="kc">n</span><span class="err">_id</span>
<span class="w">    </span><span class="err">pm_api_</span><span class="kc">t</span><span class="err">oke</span><span class="kc">n</span><span class="err">_secre</span><span class="kc">t</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="err">var.pm_api_</span><span class="kc">t</span><span class="err">oke</span><span class="kc">n</span><span class="err">_secre</span><span class="kc">t</span>
<span class="w">    </span><span class="err">pm_</span><span class="kc">tls</span><span class="err">_i</span><span class="kc">nse</span><span class="err">cure</span><span class="w">     </span><span class="err">=</span><span class="w"> </span><span class="kc">false</span>
<span class="p">}</span>

<span class="err">resource</span><span class="w"> </span><span class="s2">&quot;proxmox_lxc&quot;</span><span class="w"> </span><span class="s2">&quot;testct&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="err">hos</span><span class="kc">tna</span><span class="err">me</span><span class="w">     </span><span class="err">=</span><span class="w"> </span><span class="err">var.lxc_</span><span class="kc">na</span><span class="err">me</span>
<span class="w">  </span><span class="kc">tar</span><span class="err">ge</span><span class="kc">t</span><span class="err">_</span><span class="kc">n</span><span class="err">ode</span><span class="w">  </span><span class="err">=</span><span class="w"> </span><span class="s2">&quot;pve&quot;</span>
<span class="w">  </span><span class="err">vmid</span><span class="w">         </span><span class="err">=</span><span class="w"> </span><span class="err">var.lxc_id</span>
<span class="w">  </span><span class="err">os</span><span class="kc">te</span><span class="err">mpla</span><span class="kc">te</span><span class="w">   </span><span class="err">=</span><span class="w"> </span><span class="s2">&quot;Media4TBnvme:vztmpl/debian-12-standard_12.7-1_amd64.tar.zst&quot;</span>
<span class="w">  </span><span class="err">password</span><span class="w">     </span><span class="err">=</span><span class="w"> </span><span class="err">var.roo</span><span class="kc">t</span><span class="err">password</span>
<span class="w">  </span><span class="err">u</span><span class="kc">n</span><span class="err">privileged</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="kc">true</span>
<span class="w">  </span><span class="err">cores</span><span class="w">        </span><span class="err">=</span><span class="w"> </span><span class="mi">2</span>
<span class="w">  </span><span class="err">memory</span><span class="w">       </span><span class="err">=</span><span class="w"> </span><span class="mi">512</span>
<span class="w">  </span><span class="err">swap</span><span class="w">         </span><span class="err">=</span><span class="w"> </span><span class="mi">512</span>
<span class="w">  </span><span class="err">o</span><span class="kc">n</span><span class="err">boo</span><span class="kc">t</span><span class="w">       </span><span class="err">=</span><span class="w"> </span><span class="kc">true</span>
<span class="w">  </span><span class="err">s</span><span class="kc">tart</span><span class="w">        </span><span class="err">=</span><span class="w"> </span><span class="kc">true</span>


<span class="w">  </span><span class="err">roo</span><span class="kc">tfs</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="err">s</span><span class="kc">t</span><span class="err">orage</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="s2">&quot;local-lvm&quot;</span>
<span class="w">    </span><span class="err">size</span><span class="w">    </span><span class="err">=</span><span class="w"> </span><span class="s2">&quot;8G&quot;</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="kc">net</span><span class="err">work</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kc">na</span><span class="err">me</span><span class="w">   </span><span class="err">=</span><span class="w"> </span><span class="s2">&quot;eth0&quot;</span>
<span class="w">    </span><span class="err">bridge</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="s2">&quot;vmbr0&quot;</span>
<span class="w">    </span><span class="err">ip</span><span class="w">     </span><span class="err">=</span><span class="w"> </span><span class="s2">&quot;dhcp&quot;</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="kc">features</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kc">nest</span><span class="err">i</span><span class="kc">n</span><span class="err">g</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="kc">true</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p><strong>Purpose:</strong> Deploy unprivileged Debian 12 containers with security isolation and resource limits suitable for containerized workloads.</p>
<p><strong>Key sections:</strong></p>
<ul>
<li><strong>Provider declaration</strong> → Uses Terraform-for-Proxmox/proxmox provider</li>
<li><strong>Authentication variables</strong> → API token ID &amp; secret, plus root password for the container</li>
<li><strong>Proxmox provider block</strong> → Points to the PVE API over HTTPS with certificate validation (pm_tls_insecure = false)</li>
<li><strong>LXC resource</strong> (proxmox_lxc):</li>
<li>Hostname &amp; VMID variable arguments provided in the terraform plan command</li>
<li>Template source (ostemplate) from Proxmox storage</li>
<li>Unprivileged mode for added security isolation</li>
<li>Resource limits: 2 CPU cores, 512 MB RAM + swap</li>
<li>Disk allocation: 8 GB on local-lvm storage</li>
<li>Networking: virt‑bridge to vmbr0 via DHCP</li>
<li>Features: nesting enabled (allowing Docker/Kubernetes inside the LXC)</li>
<li>Boot &amp; start flags so it powers up with the node</li>
</ul>
<p><strong>Resource Allocation Strategy:</strong></p>
<ul>
<li>CPU: 2 cores (sufficient for most containerized apps)</li>
<li>Memory: 512MB + 512MB swap (low footprint for density)</li>
<li>Disk: 8GB (expandable, allocated on local-lvm for performance)</li>
<li>Network: DHCP with VLAN tagging support via bridge</li>
</ul>
<p><strong>Security Features:</strong></p>
<ul>
<li>Unprivileged Containers: UID/GID mapping prevents root escalation to host</li>
<li>Nesting Enabled: Allows Docker-in-LXC for lab flexibility</li>
<li>AppArmor Profile: Default Proxmox profile applied</li>
<li>Resource Limits: Prevent resource exhaustion attacks</li>
</ul>
<h4 id="vm-provisioning-maintf-qemu">VM Provisioning (main.tf - QEMU)<a class="headerlink" href="#vm-provisioning-maintf-qemu" title="Permanent link">&para;</a></h4>
<p><strong>Purpose:</strong> Clone cloud-init ready Ubuntu VMs with optimized storage and network configuration for performance and manageability.</p>
<div class="highlight"><pre><span></span><code><span class="kc">terraf</span><span class="err">orm</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="err">required_providers</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="err">proxmox</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="err">source</span><span class="w">  </span><span class="err">=</span><span class="w"> </span><span class="s2">&quot;Terraform-for-Proxmox/proxmox&quot;</span>
<span class="w">      </span><span class="err">#versio</span><span class="kc">n</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="s2">&quot;~&gt; 0.65&quot;</span><span class="w"> </span><span class="err">#</span><span class="w"> </span><span class="err">or</span><span class="w"> </span><span class="err">la</span><span class="kc">test</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>

<span class="err">variable</span><span class="w"> </span><span class="s2">&quot;pm_api_token_id&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="err">descrip</span><span class="kc">t</span><span class="err">io</span><span class="kc">n</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="s2">&quot;Proxmox API token ID&quot;</span>
<span class="w">  </span><span class="kc">t</span><span class="err">ype</span><span class="w">        </span><span class="err">=</span><span class="w"> </span><span class="err">s</span><span class="kc">tr</span><span class="err">i</span><span class="kc">n</span><span class="err">g</span>
<span class="p">}</span>

<span class="err">variable</span><span class="w"> </span><span class="s2">&quot;pm_api_token_secret&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="err">descrip</span><span class="kc">t</span><span class="err">io</span><span class="kc">n</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="s2">&quot;Proxmox API token secret&quot;</span>
<span class="w">  </span><span class="kc">t</span><span class="err">ype</span><span class="w">        </span><span class="err">=</span><span class="w"> </span><span class="err">s</span><span class="kc">tr</span><span class="err">i</span><span class="kc">n</span><span class="err">g</span>
<span class="w">  </span><span class="err">se</span><span class="kc">ns</span><span class="err">i</span><span class="kc">t</span><span class="err">ive</span><span class="w">   </span><span class="err">=</span><span class="w"> </span><span class="kc">true</span>
<span class="p">}</span>
<span class="err">variable</span><span class="w"> </span><span class="s2">&quot;ciuser&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="err">descrip</span><span class="kc">t</span><span class="err">io</span><span class="kc">n</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="s2">&quot;Cloud-init username for this VM&quot;</span>
<span class="w">  </span><span class="kc">t</span><span class="err">ype</span><span class="w">        </span><span class="err">=</span><span class="w"> </span><span class="err">s</span><span class="kc">tr</span><span class="err">i</span><span class="kc">n</span><span class="err">g</span>
<span class="p">}</span>

<span class="err">variable</span><span class="w"> </span><span class="s2">&quot;cipassword&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="err">descrip</span><span class="kc">t</span><span class="err">io</span><span class="kc">n</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="s2">&quot;Cloud-init password for this VM&quot;</span>
<span class="w">  </span><span class="kc">t</span><span class="err">ype</span><span class="w">        </span><span class="err">=</span><span class="w"> </span><span class="err">s</span><span class="kc">tr</span><span class="err">i</span><span class="kc">n</span><span class="err">g</span>
<span class="w">  </span><span class="err">se</span><span class="kc">ns</span><span class="err">i</span><span class="kc">t</span><span class="err">ive</span><span class="w">   </span><span class="err">=</span><span class="w"> </span><span class="kc">true</span>
<span class="p">}</span>

<span class="err">variable</span><span class="w"> </span><span class="s2">&quot;vm_name&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="err">descrip</span><span class="kc">t</span><span class="err">io</span><span class="kc">n</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="s2">&quot;Name of the VM&quot;</span>
<span class="w">  </span><span class="kc">t</span><span class="err">ype</span><span class="w">        </span><span class="err">=</span><span class="w"> </span><span class="err">s</span><span class="kc">tr</span><span class="err">i</span><span class="kc">n</span><span class="err">g</span>
<span class="w">  </span><span class="err">de</span><span class="kc">fault</span><span class="w">     </span><span class="err">=</span><span class="w"> </span><span class="s2">&quot;ubuntu-vm&quot;</span>

<span class="p">}</span>

<span class="err">variable</span><span class="w"> </span><span class="s2">&quot;vm_id&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="err">descrip</span><span class="kc">t</span><span class="err">io</span><span class="kc">n</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="s2">&quot;VMID for the VM&quot;</span>
<span class="w">  </span><span class="kc">t</span><span class="err">ype</span><span class="w">        </span><span class="err">=</span><span class="w"> </span><span class="kc">nu</span><span class="err">mber</span>
<span class="p">}</span>


<span class="err">provider</span><span class="w"> </span><span class="s2">&quot;proxmox&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="err">pm_api_url</span><span class="w">          </span><span class="err">=</span><span class="w"> </span><span class="s2">&quot;https://pve.home.com:8006/api2/json&quot;</span>
<span class="w">    </span><span class="err">pm_api_</span><span class="kc">t</span><span class="err">oke</span><span class="kc">n</span><span class="err">_id</span><span class="w">     </span><span class="err">=</span><span class="w"> </span><span class="err">var.pm_api_</span><span class="kc">t</span><span class="err">oke</span><span class="kc">n</span><span class="err">_id</span>
<span class="w">    </span><span class="err">pm_api_</span><span class="kc">t</span><span class="err">oke</span><span class="kc">n</span><span class="err">_secre</span><span class="kc">t</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="err">var.pm_api_</span><span class="kc">t</span><span class="err">oke</span><span class="kc">n</span><span class="err">_secre</span><span class="kc">t</span>
<span class="w">    </span><span class="err">pm_</span><span class="kc">tls</span><span class="err">_i</span><span class="kc">nse</span><span class="err">cure</span><span class="w">     </span><span class="err">=</span><span class="w"> </span><span class="kc">false</span>
<span class="p">}</span>

<span class="err">resource</span><span class="w"> </span><span class="s2">&quot;proxmox_vm_qemu&quot;</span><span class="w"> </span><span class="s2">&quot;ubuntu-vm&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kc">na</span><span class="err">me</span><span class="w">                </span><span class="err">=</span><span class="w"> </span><span class="err">var.vm_</span><span class="kc">na</span><span class="err">me</span>
<span class="w">    </span><span class="err">vmid</span><span class="w">                </span><span class="err">=</span><span class="w"> </span><span class="err">var.vm_id</span>
<span class="w">    </span><span class="kc">tar</span><span class="err">ge</span><span class="kc">t</span><span class="err">_</span><span class="kc">n</span><span class="err">ode</span><span class="w">         </span><span class="err">=</span><span class="w"> </span><span class="s2">&quot;pve&quot;</span>
<span class="w">    </span><span class="err">clo</span><span class="kc">ne</span><span class="w">               </span><span class="err">=</span><span class="w"> </span><span class="s2">&quot;ubuntu-cloud&quot;</span>
<span class="w">    </span><span class="kc">full</span><span class="err">_clo</span><span class="kc">ne</span><span class="w">          </span><span class="err">=</span><span class="w"> </span><span class="kc">true</span>
<span class="w">    </span><span class="err">cores</span><span class="w">               </span><span class="err">=</span><span class="w"> </span><span class="mi">2</span>
<span class="w">    </span><span class="err">memory</span><span class="w">              </span><span class="err">=</span><span class="w"> </span><span class="mi">2048</span>
<span class="w">    </span><span class="err">socke</span><span class="kc">ts</span><span class="w">             </span><span class="err">=</span><span class="w"> </span><span class="mi">1</span>
<span class="w">    </span><span class="err">o</span><span class="kc">n</span><span class="err">boo</span><span class="kc">t</span><span class="w">              </span><span class="err">=</span><span class="w"> </span><span class="kc">true</span>
<span class="w">    </span><span class="err">age</span><span class="kc">nt</span><span class="w">               </span><span class="err">=</span><span class="w"> </span><span class="mi">1</span>
<span class="w">    </span><span class="err">os_</span><span class="kc">t</span><span class="err">ype</span><span class="w">             </span><span class="err">=</span><span class="w"> </span><span class="s2">&quot;l26&quot;</span>
<span class="w">    </span><span class="err">clo</span><span class="kc">ne</span><span class="err">_wai</span><span class="kc">t</span><span class="w">          </span><span class="err">=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">    </span><span class="err">ciuser</span><span class="w">     </span><span class="err">=</span><span class="w"> </span><span class="err">var.ciuser</span>
<span class="w">    </span><span class="err">cipassword</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="err">var.cipassword</span>


<span class="w">    </span><span class="err">boo</span><span class="kc">t</span><span class="w">    </span><span class="err">=</span><span class="w"> </span><span class="s2">&quot;order=scsi0;ide2&quot;</span>
<span class="w">    </span><span class="err">boo</span><span class="kc">t</span><span class="err">disk</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="s2">&quot;scsi0&quot;</span>
<span class="w">    </span><span class="err">scsihw</span><span class="w">      </span><span class="err">=</span><span class="w"> </span><span class="s2">&quot;virtio-scsi-single&quot;</span>

<span class="w">    </span><span class="kc">net</span><span class="err">work</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="err">model</span><span class="w">     </span><span class="err">=</span><span class="w"> </span><span class="s2">&quot;virtio&quot;</span>
<span class="w">        </span><span class="err">bridge</span><span class="w">    </span><span class="err">=</span><span class="w"> </span><span class="s2">&quot;vmbr0&quot;</span>
<span class="w">        </span><span class="kc">f</span><span class="err">irewall</span><span class="w">  </span><span class="err">=</span><span class="w"> </span><span class="kc">false</span>
<span class="w">        </span><span class="err">li</span><span class="kc">n</span><span class="err">k_dow</span><span class="kc">n</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="kc">false</span>
<span class="w">    </span><span class="p">}</span>
</code></pre></div>
<p><strong>Key sections:</strong></p>
<ul>
<li><strong>Provider declaration</strong> → Same Terraform‑for‑Proxmox provider as above</li>
<li><strong>Authentication variables</strong> → API token ID &amp; secret; cloud-init user and password</li>
<li><strong>Proxmox provider block</strong> → HTTPS API endpoint with TLS verification</li>
<li><strong>VM resource</strong> (proxmox_vm_qemu):</li>
<li>Clones from ubuntu-cloud template (must be cloud-init ready)</li>
<li>full_clone = true → independent disk image</li>
<li>OS type set to l26 → Linux kernel 2.6+ (optimized for modern distros)</li>
<li>Hostname &amp; VMID variable arguments provided in the terraform plan command</li>
<li>Boot settings:<ul>
<li>Boot from scsi0 (OS disk) before ide2 (cloud-init)</li>
<li>Force virtio-scsi-single controller for best Linux I/O performance</li>
</ul>
</li>
<li>CPU/memory: 2 vCPUs, 2 GB RAM, 1 socket</li>
<li>QEMU guest agent enabled for status reporting &amp; IP detection</li>
<li>Networking: virtio NIC on vmbr0 with firewall disabled in guest config</li>
<li>Cloud-init parameters for provisioning user and password</li>
<li>clone_wait = 0 → Terraform doesn't block on post-clone boot readiness</li>
</ul>
<p><strong>Cloud-Init Integration:</strong></p>
<ul>
<li>User Creation: Provisions non-root user via ciuser parameter</li>
<li>SSH Keys: Injects public keys for passwordless authentication</li>
<li>Network Config: Configures DHCP or static IP via ipconfig parameters</li>
<li>Package Updates: Can specify packages to install on first boot</li>
</ul>
<p><strong>Performance Optimizations:</strong></p>
<ul>
<li>VirtIO-SCSI-Single: Modern SCSI controller with single queue (reduces overhead)</li>
<li>IOThread: Dedicated I/O thread improves disk throughput</li>
<li>SSD Flag: Enables TRIM for better SSD performance</li>
<li>VirtIO NIC: Para-virtualized network driver (near-native performance)</li>
</ul>
<h3 id="terraform-plan-output">Terraform Plan Output<a class="headerlink" href="#terraform-plan-output" title="Permanent link">&para;</a></h3>
<p><strong>Diagram Placeholder: Terraform Plan Output Screenshot</strong></p>
<h3 id="terraform-workflow">Terraform Workflow<a class="headerlink" href="#terraform-workflow" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Step</th>
<th>Command</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td>Initialize</td>
<td><code>terraform init</code></td>
<td>Download provider plugins</td>
</tr>
<tr>
<td>Validate</td>
<td><code>terraform validate</code></td>
<td>Check syntax errors</td>
</tr>
<tr>
<td>Plan</td>
<td><code>terraform plan -var="hostname=test01" ...</code></td>
<td>Preview changes</td>
</tr>
<tr>
<td>Apply</td>
<td><code>terraform apply -var="hostname=test01" ...</code></td>
<td>Execute provisioning</td>
</tr>
<tr>
<td>Destroy</td>
<td><code>terraform destroy -var="vmid=200"</code></td>
<td>Delete resources</td>
</tr>
<tr>
<td>Show State</td>
<td><code>terraform show</code></td>
<td>View current state</td>
</tr>
<tr>
<td>Refresh State</td>
<td><code>terraform refresh</code></td>
<td>Sync state with reality</td>
</tr>
</tbody>
</table>
<p><strong>Example Provisioning Command:</strong>
<div class="highlight"><pre><span></span><code>terraform<span class="w"> </span>apply<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-var<span class="o">=</span><span class="s2">&quot;hostname=docker-vm-01&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-var<span class="o">=</span><span class="s2">&quot;vmid=201&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-auto-approve
</code></pre></div></p>
<p><strong>Output:</strong> IP address, VMID, MAC address assigned</p>
<h3 id="state-management-strategy">State Management Strategy<a class="headerlink" href="#state-management-strategy" title="Permanent link">&para;</a></h3>
<p><strong>Current Implementation:</strong></p>
<ul>
<li>State File: Local terraform.tfstate in working directory</li>
<li>Locking: None (single operator environment)</li>
<li>Backup: Automated weekly backups to Proxmox Backup Server and Synology NAS</li>
</ul>
<hr />
<h2 id="3-configuration-management-with-ansible">3. Configuration Management with Ansible<a class="headerlink" href="#3-configuration-management-with-ansible" title="Permanent link">&para;</a></h2>
<h3 id="31-architecture-overview">3.1 Architecture Overview<a class="headerlink" href="#31-architecture-overview" title="Permanent link">&para;</a></h3>
<p>Ansible provides agentless configuration management through SSH-based automation, enforcing consistent baselines across all Linux hosts, managing secrets securely, and orchestrating complex multi-host operations using declarative playbooks.</p>
<p><strong>Security Impact</strong></p>
<ul>
<li>Configuration drift eliminated through automated enforcement</li>
<li>SSH hardening applied consistently across all managed hosts</li>
<li>Credential exposure prevented through Ansible Vault encryption</li>
<li>Audit trail established via Git‑based version control</li>
<li>Manual errors eliminated through idempotent playbooks</li>
</ul>
<p><strong>Deployment Rationale:</strong> In enterprise environments with 30+ Linux hosts, manual configuration becomes error-prone and time-consuming. Ansible demonstrates infrastructure-as-code principles where security baselines (CIS Benchmarks) are codified, version-controlled, and automatically enforced. This approach reduces configuration time from hours to minutes while ensuring 100% consistency across systems—critical for maintaining security posture at scale.</p>
<p><strong>Architecture Principles Alignment</strong></p>
<ul>
<li><strong>Defense in Depth:</strong> SSH hardening playbooks disable weak ciphers and enforce key-based auth; firewall rules deployed uniformly; fail2ban configured consistently across all systems</li>
<li><strong>Secure by Design:</strong> Ansible Vault encrypts sensitive variables; no plaintext credentials in playbooks; SSH keys distributed securely via initial bootstrap</li>
<li><strong>Zero Trust:</strong> Every configuration change logged to Git; no implicit trust of system state; playbooks verify current configuration before making changes</li>
</ul>
<hr />
<h3 id="32-setup-overview">3.2 Setup Overview<a class="headerlink" href="#32-setup-overview" title="Permanent link">&para;</a></h3>
<p><strong>Control plane: Ansible running in a Proxmox LXC</strong></p>
<ul>
<li>Deployed from a Proxmox Debian-based LXC ("ansible"), using a Python virtual environment</li>
<li>SSH auth is key-based via an "ansible" user</li>
<li>Handles initial configuration management to achieve a standard template across all hosts</li>
<li>Standard base packages, DNS, PKI and SSH configurations plus user accounts and permissions</li>
</ul>
<h3 id="control-plane-configuration">Control Plane Configuration<a class="headerlink" href="#control-plane-configuration" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Component</th>
<th>Details</th>
</tr>
</thead>
<tbody>
<tr>
<td>Ansible Controller</td>
<td>Debian 12 LXC (192.168.x.x)</td>
</tr>
<tr>
<td>Ansible Version</td>
<td>2.16.x (core)</td>
</tr>
<tr>
<td>Python Environment</td>
<td>venv isolated (Python 3.11)</td>
</tr>
<tr>
<td>Authentication</td>
<td>SSH key-based (ed25519)</td>
</tr>
<tr>
<td>Privilege Escalation</td>
<td>sudo (passwordless for ansible user)</td>
</tr>
<tr>
<td>Inventory</td>
<td>Dynamic (Proxmox API) + static YAML</td>
</tr>
<tr>
<td>Vault Encryption</td>
<td>ansible-vault with AES-256</td>
</tr>
</tbody>
</table>
<h3 id="ssh-key-architecture">SSH Key Architecture<a class="headerlink" href="#ssh-key-architecture" title="Permanent link">&para;</a></h3>
<ul>
<li>Key Type: ed25519 (modern, secure, performant)</li>
<li>Key Location: /home/ansible/.ssh/id_ed25519</li>
<li>Passphrase: Stored in Vaultwarden, loaded to ssh-agent</li>
<li>Distribution: Public key deployed via cloud-init or initial playbook</li>
<li>Rotation: Annual key rotation with documented rollover procedure</li>
</ul>
<h3 id="ansible-user-configuration">Ansible User Configuration<a class="headerlink" href="#ansible-user-configuration" title="Permanent link">&para;</a></h3>
<p>The "ansible" service account is created on all managed hosts with these attributes:</p>
<ul>
<li>Username: ansible</li>
<li>Shell: /bin/bash</li>
<li>Groups: ansible, sudo (or wheel on RHEL)</li>
<li>Sudo Access: NOPASSWD for all commands (required for automation)</li>
<li>Home Directory: /home/ansible</li>
<li>SSH AuthorizedKeys: Controller public key only</li>
</ul>
<p><strong>Security Considerations:</strong></p>
<p>Sudo Without Password: Required for unattended automation. Mitigated by:</p>
<ul>
<li>ansible user cannot authenticate via password (PasswordAuthentication no)</li>
<li>SSH key private key is passphrase-protected</li>
<li>Access limited to Ansible controller IP via SSH config</li>
<li>All actions logged via auditd and forwarded to Splunk</li>
</ul>
<hr />
<h3 id="33-playbook-architecture">3.3 Playbook Architecture<a class="headerlink" href="#33-playbook-architecture" title="Permanent link">&para;</a></h3>
<h4 id="bootstrap-playbook-new_installyaml">Bootstrap Playbook (new_install.yaml)<a class="headerlink" href="#bootstrap-playbook-new_installyaml" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="nn">---</span>
<span class="p p-Indicator">-</span><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Freah install of Linux VM/LXC, add ansible user and SSH access</span>
<span class="w">   </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">all</span>
<span class="w">   </span><span class="nt">tags</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">always</span>
<span class="w">   </span><span class="nt">become</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>

<span class="w">   </span><span class="nt">handlers</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Restart systemd-resolved (if needed)</span>
<span class="w">      </span><span class="nt">ansible.builtin.systemd</span><span class="p">:</span>
<span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">systemd-resolved</span>
<span class="w">        </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">restarted</span>
<span class="w">        </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yes</span>
<span class="w">      </span><span class="nt">when</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ansible_service_mgr == &quot;systemd&quot;</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;&#39;systemd-resolved.service&#39;</span><span class="nv"> </span><span class="s">in</span><span class="nv"> </span><span class="s">ansible_facts.services</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">default({})&quot;</span>

<span class="w">   </span><span class="nt">pre_tasks</span><span class="p">:</span>

<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Update all packages on RedHat family</span>
<span class="w">      </span><span class="nt">dnf</span><span class="p">:</span>
<span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;*&quot;</span>
<span class="w">        </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">latest</span>
<span class="w">        </span><span class="nt">update_cache</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yes</span>
<span class="w">      </span><span class="nt">when</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ansible_os_family == &quot;RedHat&quot;</span>

<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Update all packages on Debian family</span>
<span class="w">      </span><span class="nt">apt</span><span class="p">:</span>
<span class="w">        </span><span class="nt">upgrade</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dist</span>
<span class="w">        </span><span class="nt">update_cache</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yes</span>
<span class="w">        </span><span class="nt">cache_valid_time</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3600</span>
<span class="w">      </span><span class="nt">when</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ansible_os_family == &quot;Debian&quot;</span>

<span class="w">   </span><span class="nt">tasks</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">add new user</span>
<span class="w">      </span><span class="nt">become</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">      </span><span class="nt">tags</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">always</span>
<span class="w">      </span><span class="nt">ansible.builtin.user</span><span class="p">:</span>
<span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ansible</span>
<span class="w">        </span><span class="nt">group</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">root</span>
<span class="w">        </span><span class="nt">shell</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/bin/bash</span>
<span class="w">        </span><span class="nt">password</span><span class="p">:</span><span class="w">  </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">&#39;-----&#39;</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">password_hash(&#39;sha512&#39;)</span><span class="nv"> </span><span class="s">}}&quot;</span>

<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Ensure OpenSSH server is installed</span>
<span class="w">      </span><span class="nt">package</span><span class="p">:</span>
<span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">openssh-server</span>
<span class="w">        </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">present</span>

<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Backup existing sshd_config</span>
<span class="w">      </span><span class="nt">become</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">      </span><span class="nt">copy</span><span class="p">:</span>
<span class="w">        </span><span class="nt">src</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/etc/ssh/sshd_config</span>
<span class="w">        </span><span class="nt">dest</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/etc/ssh/sshd_config.bak</span>
<span class="w">        </span><span class="nt">remote_src</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yes</span>
<span class="w">      </span><span class="nt">when</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ansible_facts[&#39;os_family&#39;] != &#39;Windows&#39;</span>

<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Set SSH configuration options</span>
<span class="w">      </span><span class="nt">become</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">      </span><span class="nt">lineinfile</span><span class="p">:</span>
<span class="w">        </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/etc/ssh/sshd_config</span>
<span class="w">        </span><span class="nt">regexp</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;^#?{{</span><span class="nv"> </span><span class="s">item.key</span><span class="nv"> </span><span class="s">}}&#39;</span>
<span class="w">        </span><span class="nt">line</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;{{</span><span class="nv"> </span><span class="s">item.key</span><span class="nv"> </span><span class="s">}}</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">item.value</span><span class="nv"> </span><span class="s">}}&#39;</span>
<span class="w">        </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">present</span>
<span class="w">        </span><span class="nt">create</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yes</span>
<span class="w">        </span><span class="nt">backup</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yes</span>
<span class="w">      </span><span class="nt">loop</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="nt"> key</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;PermitRootLogin&#39;</span><span class="p p-Indicator">,</span><span class="nt"> value</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;no&#39;</span><span class="w"> </span><span class="p p-Indicator">}</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="nt"> key</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;PasswordAuthentication&#39;</span><span class="p p-Indicator">,</span><span class="nt"> value</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;no&#39;</span><span class="w"> </span><span class="p p-Indicator">}</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="nt"> key</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;PubkeyAuthentication&#39;</span><span class="p p-Indicator">,</span><span class="nt"> value</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;yes&#39;</span><span class="w"> </span><span class="p p-Indicator">}</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="nt"> key</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;AuthorizedKeysFile&#39;</span><span class="p p-Indicator">,</span><span class="nt"> value</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;.ssh/authorized_keys&#39;</span><span class="w"> </span><span class="p p-Indicator">}</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="nt"> key</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;PermitEmptyPasswords&#39;</span><span class="p p-Indicator">,</span><span class="nt"> value</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;no&#39;</span><span class="w"> </span><span class="p p-Indicator">}</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="nt"> key</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;ChallengeResponseAuthentication&#39;</span><span class="p p-Indicator">,</span><span class="nt"> value</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;no&#39;</span><span class="w"> </span><span class="p p-Indicator">}</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="nt"> key</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;UsePAM&#39;</span><span class="p p-Indicator">,</span><span class="nt"> value</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;yes&#39;</span><span class="w"> </span><span class="p p-Indicator">}</span>

<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Ensure SSH service is enabled and restarted</span>
<span class="w">      </span><span class="nt">become</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">      </span><span class="nt">service</span><span class="p">:</span>
<span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item</span><span class="nv">  </span><span class="s">}}&quot;</span>
<span class="w">        </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">restarted</span>
<span class="w">        </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yes</span>
<span class="w">      </span><span class="nt">loop</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ssh</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sshd</span>


<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Ensure .ssh directory exists for ansible user</span>
<span class="w">      </span><span class="nt">become</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">      </span><span class="nt">file</span><span class="p">:</span>
<span class="w">        </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/home/ansible/.ssh</span>
<span class="w">        </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">directory</span>
<span class="w">        </span><span class="nt">owner</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ansible</span>
<span class="w">        </span><span class="nt">group</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">root</span>
<span class="w">        </span><span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;0700&#39;</span>

<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">add SSH key for ansible host</span>
<span class="w">      </span><span class="nt">become</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">      </span><span class="nt">tags</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">always</span>
<span class="w">      </span><span class="nt">ansible.posix.authorized_key</span><span class="p">:</span>
<span class="w">        </span><span class="nt">user</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ansible</span>
<span class="w">        </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;ssh-ed25519</span><span class="nv"> </span><span class="s">------------</span><span class="nv"> </span><span class="s">root@ansible&quot;</span>
<span class="w">        </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">present</span>

<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Ensure sudo is installed</span>
<span class="w">      </span><span class="nt">package</span><span class="p">:</span>
<span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sudo</span>
<span class="w">        </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">present</span>

<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Ensure /etc/sudoers.d exists</span>
<span class="w">      </span><span class="nt">become</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">      </span><span class="nt">file</span><span class="p">:</span>
<span class="w">        </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/etc/sudoers.d</span>
<span class="w">        </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">directory</span>
<span class="w">        </span><span class="nt">owner</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">root</span>
<span class="w">        </span><span class="nt">group</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">root</span>
<span class="w">        </span><span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;0750&#39;</span>

<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">add sudoers file to ansible</span>
<span class="w">      </span><span class="nt">become</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">      </span><span class="nt">ansible.builtin.copy</span><span class="p">:</span>
<span class="w">        </span><span class="nt">src</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sudoer_ansible</span>
<span class="w">        </span><span class="nt">dest</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/etc/sudoers.d/ansible</span>
<span class="w">        </span><span class="nt">owner</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">root</span>
<span class="w">        </span><span class="nt">group</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">root</span>
<span class="w">        </span><span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;0440&#39;</span>
<span class="w">        </span><span class="nt">validate</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;/usr/sbin/visudo</span><span class="nv"> </span><span class="s">-cf</span><span class="nv"> </span><span class="s">%s&#39;</span>

<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Replace /etc/resolv.conf with specified nameservers</span>
<span class="w">      </span><span class="nt">copy</span><span class="p">:</span>
<span class="w">        </span><span class="nt">dest</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/etc/resolv.conf</span>
<span class="w">        </span><span class="nt">content</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">          </span><span class="no">nameserver 192.168.1.250</span>
<span class="w">          </span><span class="no">nameserver 192.168.1.126</span>
<span class="w">        </span><span class="nt">owner</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">root</span>
<span class="w">        </span><span class="nt">group</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">root</span>
<span class="w">        </span><span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;0644&#39;</span>
<span class="w">        </span><span class="nt">backup</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yes</span>
<span class="w">      </span><span class="nt">notify</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Restart systemd-resolved (if needed)</span>


<span class="p p-Indicator">-</span><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">add a new user and enable remote access via SSH</span>
<span class="w">   </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">all</span>
<span class="w">   </span><span class="nt">become</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>

<span class="w">   </span><span class="nt">handlers</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Restart systemd-resolved (if needed)</span>
<span class="w">      </span><span class="nt">ansible.builtin.systemd</span><span class="p">:</span>
<span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">systemd-resolved</span>
<span class="w">        </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">restarted</span>
<span class="w">        </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yes</span>
<span class="w">      </span><span class="nt">when</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ansible_service_mgr == &quot;systemd&quot;</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;&#39;systemd-resolved.service&#39;</span><span class="nv"> </span><span class="s">in</span><span class="nv"> </span><span class="s">ansible_facts.services</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">default({})&quot;</span>


<span class="w">    </span><span class="c1"># Debian reboot check</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Check if reboot is required (Debian/Ubuntu)</span>
<span class="w">      </span><span class="nt">stat</span><span class="p">:</span>
<span class="w">        </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/var/run/reboot-required</span>
<span class="w">      </span><span class="nt">register</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">reboot_required</span>
<span class="w">      </span><span class="nt">when</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ansible_os_family == &quot;Debian&quot;</span>

<span class="w">    </span><span class="c1"># RedHat reboot check</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Check if reboot is required (RedHat family)</span>
<span class="w">      </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">needs-restarting -r</span>
<span class="w">      </span><span class="nt">register</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">needs_reboot</span>
<span class="w">      </span><span class="nt">failed_when</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<span class="w">      </span><span class="nt">changed_when</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<span class="w">      </span><span class="nt">when</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ansible_os_family == &quot;RedHat&quot;</span>

<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Reboot if required (Debian)</span>
<span class="w">      </span><span class="nt">reboot</span><span class="p">:</span>
<span class="w">      </span><span class="nt">when</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">reboot_required.stat.exists</span>

<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Reboot if required (RedHat)</span>
<span class="w">      </span><span class="nt">reboot</span><span class="p">:</span>
<span class="w">      </span><span class="nt">when</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">needs_reboot.rc == 1</span>
</code></pre></div>
<p><strong>Purpose:</strong> Initial host configuration to establish Ansible management capability.</p>
<p><strong>Execution:</strong> Run once after Terraform provisions new host.</p>
<p><strong>What it does:</strong></p>
<ul>
<li>Updates the repositories, applies any software updates</li>
<li>Creates the "ansible" user with a login shell and hashed password</li>
<li>Ensures OpenSSH server is installed</li>
<li>Backs up /etc/ssh/sshd_config and sets key options:</li>
<li>PermitRootLogin no</li>
<li>PasswordAuthentication no</li>
<li>PubkeyAuthentication yes</li>
<li>AuthorizedKeysFile .ssh/authorized_keys</li>
<li>PermitEmptyPasswords no</li>
<li>ChallengeResponseAuthentication no</li>
<li>UsePAM yes</li>
<li>Restarts and enables the SSH service (service name differs by distro: "ssh" on Debian/Ubuntu, "sshd" on RHEL/CentOS)</li>
<li>Creates /home/ansible/.ssh with strict permissions</li>
<li>Adds the control node's public key to ansible's authorized_keys</li>
<li>Installs sudo, ensures /etc/sudoers.d exists (0750), and drops a validated sudoers entry for "ansible" (via visudo -cf)</li>
<li>Restart SSH only when the config changes (handler) to reduce risk during provisioning</li>
<li>Configures the lab DNS nameservers in the resolv.conf file</li>
</ul>
<h3 id="additional-playbooks">Additional Playbooks<a class="headerlink" href="#additional-playbooks" title="Permanent link">&para;</a></h3>
<p><strong>Hardening Playbook (security_baseline.yaml):</strong></p>
<ul>
<li>Configures firewall rules (ufw/firewalld)</li>
<li>Installs fail2ban for brute force protection</li>
<li>Enables automatic security updates</li>
<li>Configures auditd for system logging</li>
<li>Deploys CrowdSec agent for threat intelligence</li>
</ul>
<p><strong>PKI Certificate Deployment (deploy_certificates.yaml):</strong></p>
<ul>
<li>Distributes Step-CA root certificate to trust store</li>
<li>Configures automatic cert renewal via ACME client</li>
<li>Updates TLS configurations for services</li>
</ul>
<p><strong>User Management (manage_users.yaml):</strong></p>
<ul>
<li>Creates standard user accounts across hosts</li>
<li>Deploys SSH keys from centralized source</li>
<li>Configures user-specific sudo permissions</li>
</ul>
<hr />
<h2 id="4-version-control-and-gitops">4. Version Control and GitOps<a class="headerlink" href="#4-version-control-and-gitops" title="Permanent link">&para;</a></h2>
<h3 id="version-control-strategy">Version Control Strategy<a class="headerlink" href="#version-control-strategy" title="Permanent link">&para;</a></h3>
<p><strong>Diagram Placeholder: GitHub Repository Screenshots (3 images)</strong></p>
<p>All infrastructure‑as‑code assets for this solution — including Ansible playbooks, Terraform configurations, and related modules — are stored in a dedicated GitHub repository using Git on the local host.</p>
<p>This <a href="https://github.com/pnleone/Lab-Configs">central repository</a> provides:</p>
<ul>
<li><strong>Version history</strong> — Every change is committed with a message on what changed, enabling full audit trails for infrastructure modifications</li>
<li><strong>Consistency across environments</strong> — Ansible roles and Terraform modules are version‑locked so the same codebase can be applied to multiple hosts</li>
<li><strong>Rollback capability</strong> — Previous commits can be checked out to restore infrastructure to a known good state quickly in case of issues</li>
</ul>
<p>Configuration files for hosted and platform services — including YAML, JSON, HTML, CSS, Python, and PowerShell scripts — are stored in a separate repository. This repository is fully integrated with Visual Studio Code, allowing seamless local and remote (via SSH) integration editing.</p>
<p>By keeping both provisioning (Terraform) and configuration management (Ansible) in one repository, and separating hosted/platform service configs into another, the architecture ensures that each layer of the stack is versioned, auditable, and maintainable.</p>
<hr />
<h2 id="5-workflow-automation-with-n8n">5. Workflow Automation with n8n<a class="headerlink" href="#5-workflow-automation-with-n8n" title="Permanent link">&para;</a></h2>
<h3 id="51-platform-overview">5.1 Platform Overview<a class="headerlink" href="#51-platform-overview" title="Permanent link">&para;</a></h3>
<p>n8n is a self-hosted, low-code workflow automation platform enabling visual workflow design with conditional logic, error handling, loops, and data transformation. Deployed as a containerized service behind Traefik reverse proxy with Authentik SSO.</p>
<p><strong>Security Impact</strong></p>
<ul>
<li>Security operations accelerated through automated SOAR workflows</li>
<li>Manual triage eliminated via automated alert enrichment</li>
<li>MTTR reduced through auto‑generated remediation playbooks</li>
<li>Alert fatigue minimized through intelligent deduplication and correlation</li>
<li>Compliance audit trails automatically documented throughout the incident lifecycle</li>
</ul>
<p><strong>Deployment Rationale:</strong> Security operations generate thousands of events daily, manual triage is unsustainable. n8n demonstrates Security Orchestration, Automation and Response (SOAR) capabilities where vulnerability scans trigger automated ticket creation, threat intelligence enrichment queries multiple APIs, and incident response playbooks execute without human intervention. This mirrors enterprise SOAR platforms (Splunk SOAR, Palo Alto Cortex XSOAR) where analyst efficiency is multiplied through automation.</p>
<p><strong>Architecture Principles Alignment</strong></p>
<ul>
<li><strong>Defense in Depth:</strong> Automated vulnerability remediation workflows execute Ansible playbooks; firewall rule changes logged and reviewed; failed automation triggers manual fallback procedures</li>
<li><strong>Secure by Design:</strong> Credentials stored in n8n credential vault (encrypted at rest); webhook endpoints authenticated via Authentik tokens; workflow execution logs forwarded to SIEM</li>
<li><strong>Zero Trust:</strong> Every automation action logged with timestamp/user; no hardcoded credentials; API tokens expire and rotate automatically</li>
</ul>
<h3 id="n8n-configuration">n8n Configuration<a class="headerlink" href="#n8n-configuration" title="Permanent link">&para;</a></h3>
<ul>
<li>Version: n8n v1.x (latest stable)</li>
<li>Execution Mode: Main process (not queue mode for simplicity)</li>
<li>Webhook URL: https://n8n.home.com</li>
<li>TLS Certificate: Step-CA issued, auto-renewed</li>
<li>Authentication: SSO via Authentik (no local passwords)</li>
<li>Monitoring: Uptime Kuma</li>
<li>Notifications: Discord webhooks</li>
</ul>
<h3 id="security-controls_1">Security Controls<a class="headerlink" href="#security-controls_1" title="Permanent link">&para;</a></h3>
<ul>
<li>Credential Encryption: All API tokens encrypted at rest</li>
<li>Webhook Security: HMAC signature validation on inbound webhooks</li>
<li>Audit Trail: All workflow executions logged with timestamp and user</li>
</ul>
<h3 id="lab-use-cases">Lab Use Cases<a class="headerlink" href="#lab-use-cases" title="Permanent link">&para;</a></h3>
<ul>
<li>Daily threat Intelligence Alerts</li>
<li>Ansible Playbook automation</li>
</ul>
<hr />
<h3 id="52-workflow-1-ansible-playbook-automation">5.2 Workflow 1: Ansible Playbook Automation<a class="headerlink" href="#52-workflow-1-ansible-playbook-automation" title="Permanent link">&para;</a></h3>
<p><strong>Purpose:</strong> Automated weekly configuration audit and system updates across lab infrastructure.</p>
<p>This automated workflow runs two playbooks, a weekly schedule and performs a configuration audit across lab hosts and a Linux repository update and upgrade cycle. It collects key system metadata and securely publishes the results for review and alerting.</p>
<p><strong>Workflow Summary:</strong></p>
<ul>
<li><strong>Scheduled Execution</strong>: Triggered weekly via n8n's Cron node</li>
<li><strong>Ansible Playbook</strong>:</li>
<li>Gathers hostnames, nameservers, SSH keys, and other configuration details across all Linux hosts</li>
<li>(sudo) apt update &amp;&amp; apt upgrade -y / (sudo) dnf check-update &amp;&amp; (sudo) dnf update -y</li>
<li><strong>GitHub Upload</strong>: Converts playbook output to a structured JSON file and commits it to the n8n-Ansible-playbook-results/ folder in the lab GitHub repository</li>
<li><strong>Discord Alert</strong>: Sends a formatted notification to a private Discord channel upon successful upload, including timestamp and file reference</li>
</ul>
<h3 id="workflow-nodes">Workflow Nodes<a class="headerlink" href="#workflow-nodes" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Node Type</th>
<th>Configuration</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td>Schedule Trigger</td>
<td>Cron: 0 2 * * 6 (Saturday 2 AM)</td>
<td>Weekly execution</td>
</tr>
<tr>
<td>SSH Node 1</td>
<td>Host: ansible-controller.home.com; Command: ansible-playbook config_audit.yml</td>
<td>Run audit playbook</td>
</tr>
<tr>
<td>SSH Node 2</td>
<td>Host: ansible-controller.home.com; Command: ansible-playbook linux_updates.yml</td>
<td>Run update playbook</td>
</tr>
<tr>
<td>Function Node</td>
<td>Parse JSON output from playbooks</td>
<td>Extract results</td>
</tr>
<tr>
<td>HTTP Request</td>
<td>GitHub API: Create file in repo</td>
<td>Upload results JSON</td>
</tr>
<tr>
<td>Discord Webhook</td>
<td>Send formatted message</td>
<td>Alert on completion</td>
</tr>
<tr>
<td>Error Handler</td>
<td>Catch failures; send alert</td>
<td>Notify on errors</td>
</tr>
</tbody>
</table>
<figure class=image-large>
      <img src="/Career_Projects/assets/screenshots/n8n-ansible.png" alt="n8n Ansible Playbook Workflow">
      <figcaption style="font-size:0.9rem; color:var(--md-secondary-text-color); margin-top:0.5rem;">
        n8n Ansible Playbook Workflow.
      </figcaption>
    </figure>

<p><strong>Audit Playbook Output (JSON):</strong>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;timestamp&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2024-11-06T02:00:00Z&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;hosts_scanned&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">25</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;findings&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;ssh_keys&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;All hosts have valid keys&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;dns_config&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Correct nameservers on 23/25 hosts&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;failed_updates&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div></p>
<p><strong>Update Playbook Execution:</strong></p>
<ul>
<li>Debian/Ubuntu: apt update &amp;&amp; apt upgrade -y</li>
<li>RHEL/Fedora: dnf check-update &amp;&amp; dnf update -y</li>
<li>Success Rate: Tracked in Discord notification</li>
<li>Failed Updates: Logged for manual review</li>
</ul>
<p><strong>Workflow Benefits:</strong></p>
<ul>
<li>Eliminates manual audit tasks (saves ~2 hours/week)</li>
<li>Ensures timely security updates across all hosts</li>
<li>Provides audit trail via GitHub commits</li>
<li>Immediate notification of issues via Discord</li>
</ul>
<div class="no-toc">
<figure class="image-large">
  <img src="/Career_Projects/assets/screenshots/n8n-ansible-results.png" alt="n8n Ansible Results">
  <figcaption style="font-size:0.9rem; color:var(--md-secondary-text-color); margin-top:0.5rem;">
    n8n Ansible Playbook Results/Notification.
  </figcaption>
</figure>
</div>

<h3 id="json-output-example">JSON Output Example<a class="headerlink" href="#json-output-example" title="Permanent link">&para;</a></h3>
<h2 id="play-audit-system-info-task-gathering-facts-ok-webhomecom-ok-1921681136-ok-unboundhomecom-ok-bindhomecom-ok-1921681250-ok-uptimekhomecom-ok-19216814-ok-stepcahomecom-ok-trfkhomecom-ok-wazuhhomecom-ok-192168193-ok-19216810015-ok-1921681246-ok-192168133-ok-19216826-ok-1921682008-ok-1921682007-ok-1921681126-ok-1921681109-ok-1921681166-ok-1921681005-task-show-disk-usage-ok-webhomecom-disk_usagestdout_lines-filesystem-size-used-avail-use-mounted-on-devloop0-16g-12g-32g-79-none-492k-40k-488k-1-dev-efivarfs-192k-180k-76k-96-sysfirmwareefiefivars-tmpfs-47g-0-47g-0-devshm-tmpfs-19g-156k-19g-1-run-tmpfs-50m-0-50m-0-runlock-tmpfs-47g-124k-47g-1-tmp-tmpfs-94g-80k-94g-1-runuser0-tmpfs-94g-80k-94g-1-runuser1001-task-show-ip-address-info-ok-webhomecom-ip_infostdout_lines-1-lo-loopbackuplower_up-mtu-65536-qdisc-noqueue-state-unknown-group-default-qlen-1000-linkloopback-000000000000-brd-000000000000-inet-1270018-scope-host-lo-valid_lft-forever-preferred_lft-forever-inet6-1128-scope-host-noprefixroute-valid_lft-forever-preferred_lft-forever-2-eth0if76-broadcastmulticastuplower_up-mtu-1500-qdisc-noqueue-state-up-group-default-qlen-1000-linkether-bc2411f9a08c-brd-ffffffffffff-link-netnsid-0-inet-192168110824-brd-1921681255-scope-global-eth0-valid_lft-forever-preferred_lft-forever-inet6-fe80be2411fffef9a08c64-scope-link-proto-kernel_ll-valid_lft-forever-preferred_lft-forever-task-show-routing-table-ok-webhomecom-route_infostdout_lines-default-via-19216811-dev-eth0-proto-static-1921681024-dev-eth0-proto-kernel-scope-link-src-1921681108-task-show-hostname-ok-webhomecom-host_namestdout-apache-ubuntu-task-show-nameservers-ok-webhomecom-resolv_confstdout_lines-begin-pve-search-homecom-nameserver-1921681250-end-pve-task-show-authorized-ssh-keys-ok-webhomecom-msg-ssh-ed25519-rootansible-play-recap-1921681109-ok13-changed5-unreachable0-failed0-skipped0-rescued0-ignored0-1921681126-ok13-changed5-unreachable0-failed0-skipped0-rescued0-ignored0-1921681136-ok13-changed5-unreachable0-failed0-skipped0-rescued0-ignored0-1921681166-ok13-changed5-unreachable0-failed0-skipped0-rescued0-ignored0-1921681246-ok13-changed5-unreachable0-failed0-skipped0-rescued0-ignored0-1921681250-ok13-changed5-unreachable0-failed0-skipped0-rescued0-ignored0-192168133-ok13-changed5-unreachable0-failed0-skipped0-rescued0-ignored0-19216814-ok13-changed5-unreachable0-failed0-skipped0-rescued0-ignored0-192168193-ok13-changed5-unreachable0-failed0-skipped0-rescued0-ignored0-19216810015-ok13-changed5-unreachable0-failed0-skipped0-rescued0-ignored0-1921681005-ok12-changed5-unreachable0-failed0-skipped1-rescued0-ignored1-19216826-ok13-changed5-unreachable0-failed0-skipped0-rescued0-ignored0-1921682007-ok13-changed5-unreachable0-failed0-skipped0-rescued0-ignored0-1921682008-ok13-changed5-unreachable0-failed0-skipped0-rescued0-ignored0-bindhomecom-ok13-changed5-unreachable0-failed0-skipped0-rescued0-ignored0-stepcahomecom-ok13-changed5-unreachable0-failed0-skipped0-rescued0-ignored0-trfkhomecom-ok13-changed5-unreachable0-failed0-skipped0-rescued0-ignored0-unboundhomecom-ok13-changed5-unreachable0-failed0-skipped0-rescued0-ignored0-uptimekhomecom-ok13-changed5-unreachable0-failed0-skipped0-rescued0-ignored0-wazuhhomecom-ok13-changed5-unreachable0-failed0-skipped0-rescued0-ignored0-webhomecom-ok13-changed5-unreachable0-failed0-skipped0-rescued0-ignored0"><div class="highlight"><pre><span></span><code><span class="err">PLAY</span><span class="w"> </span><span class="p">[</span><span class="err">Audi</span><span class="kc">t</span><span class="w"> </span><span class="err">sys</span><span class="kc">te</span><span class="err">m</span><span class="w"> </span><span class="err">i</span><span class="kc">nf</span><span class="err">o</span><span class="p">]</span><span class="w"> </span><span class="err">*******************************************************</span>

<span class="err">TASK</span><span class="w"> </span><span class="p">[</span><span class="err">Ga</span><span class="kc">t</span><span class="err">heri</span><span class="kc">n</span><span class="err">g</span><span class="w"> </span><span class="err">Fac</span><span class="kc">ts</span><span class="p">]</span><span class="w"> </span><span class="err">*********************************************************</span>
<span class="err">ok</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="err">web.home.com</span><span class="p">]</span>
<span class="err">ok</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mf">192.168.1.136</span><span class="p">]</span>
<span class="err">ok</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="err">u</span><span class="kc">n</span><span class="err">bou</span><span class="kc">n</span><span class="err">d.home.com</span><span class="p">]</span>
<span class="err">ok</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="err">bi</span><span class="kc">n</span><span class="err">d.home.com</span><span class="p">]</span>
<span class="err">ok</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mf">192.168.1.250</span><span class="p">]</span>
<span class="err">ok</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="err">up</span><span class="kc">t</span><span class="err">imek.home.com</span><span class="p">]</span>
<span class="err">ok</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mf">192.168.1.4</span><span class="p">]</span>
<span class="err">ok</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="err">s</span><span class="kc">te</span><span class="err">pca.home.com</span><span class="p">]</span>
<span class="err">ok</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="kc">trf</span><span class="err">k.home.com</span><span class="p">]</span>
<span class="err">ok</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="err">wazuh.home.com</span><span class="p">]</span>
<span class="err">ok</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mf">192.168.1.93</span><span class="p">]</span>
<span class="err">ok</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mf">192.168.100.15</span><span class="p">]</span>
<span class="err">ok</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mf">192.168.1.246</span><span class="p">]</span>
<span class="err">ok</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mf">192.168.1.33</span><span class="p">]</span>
<span class="err">ok</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mf">192.168.2.6</span><span class="p">]</span>
<span class="err">ok</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mf">192.168.200.8</span><span class="p">]</span>
<span class="err">ok</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mf">192.168.200.7</span><span class="p">]</span>
<span class="err">ok</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mf">192.168.1.126</span><span class="p">]</span>
<span class="err">ok</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mf">192.168.1.109</span><span class="p">]</span>
<span class="err">ok</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mf">192.168.1.166</span><span class="p">]</span>
<span class="err">ok</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mf">192.168.100.5</span><span class="p">]</span>

<span class="err">TASK</span><span class="w"> </span><span class="p">[</span><span class="err">Show</span><span class="w"> </span><span class="err">disk</span><span class="w"> </span><span class="err">usage</span><span class="p">]</span><span class="w"> </span><span class="err">*********************************************************</span>
<span class="err">ok</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="err">web.home.com</span><span class="p">]</span><span class="w"> </span><span class="err">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;disk_usage.stdout_lines&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="s2">&quot;Filesystem      Size  Used Avail Use% Mounted on&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;/dev/loop0       16G   12G  3.2G  79% /&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;none            492K  4.0K  488K   1% /dev&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;efivarfs        192K  180K  7.6K  96% /sys/firmware/efi/efivars&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;tmpfs            47G     0   47G   0% /dev/shm&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;tmpfs            19G  156K   19G   1% /run&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;tmpfs           5.0M     0  5.0M   0% /run/lock&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;tmpfs            47G  124K   47G   1% /tmp&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;tmpfs           9.4G  8.0K  9.4G   1% /run/user/0&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;tmpfs           9.4G  8.0K  9.4G   1% /run/user/1001&quot;</span>
<span class="w">    </span><span class="p">]</span>
<span class="p">}</span>
<span class="err">TASK</span><span class="w"> </span><span class="p">[</span><span class="err">Show</span><span class="w"> </span><span class="err">IP</span><span class="w"> </span><span class="err">address</span><span class="w"> </span><span class="err">i</span><span class="kc">nf</span><span class="err">o</span><span class="p">]</span><span class="w"> </span><span class="err">****************************************************</span>
<span class="err">ok</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="err">web.home.com</span><span class="p">]</span><span class="w"> </span><span class="err">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;ip_info.stdout_lines&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="s2">&quot;1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;    inet 127.0.0.1/8 scope host lo&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;       valid_lft forever preferred_lft forever&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;    inet6 ::1/128 scope host noprefixroute &quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;       valid_lft forever preferred_lft forever&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;2: eth0@if76: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default qlen 1000&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;    link/ether bc:24:11:f9:a0:8c brd ff:ff:ff:ff:ff:ff link-netnsid 0&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;    inet 192.168.1.108/24 brd 192.168.1.255 scope global eth0&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;       valid_lft forever preferred_lft forever&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;    inet6 fe80::be24:11ff:fef9:a08c/64 scope link proto kernel_ll &quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;       valid_lft forever preferred_lft forever&quot;</span>
<span class="w">    </span><span class="p">]</span>
<span class="p">}</span>
<span class="err">TASK</span><span class="w"> </span><span class="p">[</span><span class="err">Show</span><span class="w"> </span><span class="err">rou</span><span class="kc">t</span><span class="err">i</span><span class="kc">n</span><span class="err">g</span><span class="w"> </span><span class="kc">ta</span><span class="err">ble</span><span class="p">]</span><span class="w"> </span><span class="err">******************************************************</span>
<span class="err">ok</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="err">web.home.com</span><span class="p">]</span><span class="w"> </span><span class="err">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;route_info.stdout_lines&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="s2">&quot;default via 192.168.1.1 dev eth0 proto static &quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;192.168.1.0/24 dev eth0 proto kernel scope link src 192.168.1.108 &quot;</span>
<span class="w">    </span><span class="p">]</span>
<span class="p">}</span>
<span class="err">TASK</span><span class="w"> </span><span class="p">[</span><span class="err">Show</span><span class="w"> </span><span class="err">hos</span><span class="kc">tna</span><span class="err">me</span><span class="p">]</span><span class="w"> </span><span class="err">***********************************************************</span>
<span class="err">ok</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="err">web.home.com</span><span class="p">]</span><span class="w"> </span><span class="err">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;host_name.stdout&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;apache-ubuntu&quot;</span>
<span class="p">}</span>
<span class="err">TASK</span><span class="w"> </span><span class="p">[</span><span class="err">Show</span><span class="w"> </span><span class="kc">na</span><span class="err">meservers</span><span class="p">]</span><span class="w"> </span><span class="err">********************************************************</span>
<span class="err">ok</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="err">web.home.com</span><span class="p">]</span><span class="w"> </span><span class="err">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;resolv_conf.stdout_lines&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="s2">&quot;# --- BEGIN PVE ---&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;search home.com&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;nameserver 192.168.1.250&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;# --- END PVE ---&quot;</span>
<span class="w">    </span><span class="p">]</span>
<span class="p">}</span>
<span class="err">TASK</span><span class="w"> </span><span class="p">[</span><span class="err">Show</span><span class="w"> </span><span class="err">au</span><span class="kc">t</span><span class="err">horized</span><span class="w"> </span><span class="err">SSH</span><span class="w"> </span><span class="err">keys</span><span class="p">]</span><span class="w"> </span><span class="err">************************************************</span>
<span class="err">ok</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="err">web.home.com</span><span class="p">]</span><span class="w"> </span><span class="err">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;msg&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="s2">&quot;ssh-ed25519 --------- root@ansible&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;&quot;</span>
<span class="w">    </span><span class="p">]</span>
<span class="p">}</span>
<span class="err">PLAY</span><span class="w"> </span><span class="err">RECAP</span><span class="w"> </span><span class="err">*********************************************************************</span>
<span class="mf">192.168.1.109</span><span class="w">              </span><span class="p">:</span><span class="w"> </span><span class="err">ok=</span><span class="mi">13</span><span class="w">   </span><span class="err">cha</span><span class="kc">n</span><span class="err">ged=</span><span class="mi">5</span><span class="w">    </span><span class="err">u</span><span class="kc">nrea</span><span class="err">chable=</span><span class="mi">0</span><span class="w">    </span><span class="kc">fa</span><span class="err">iled=</span><span class="mi">0</span><span class="w">    </span><span class="err">skipped=</span><span class="mi">0</span><span class="w">    </span><span class="err">rescued=</span><span class="mi">0</span><span class="w">    </span><span class="err">ig</span><span class="kc">n</span><span class="err">ored=</span><span class="mi">0</span><span class="w">   </span>
<span class="mf">192.168.1.126</span><span class="w">              </span><span class="p">:</span><span class="w"> </span><span class="err">ok=</span><span class="mi">13</span><span class="w">   </span><span class="err">cha</span><span class="kc">n</span><span class="err">ged=</span><span class="mi">5</span><span class="w">    </span><span class="err">u</span><span class="kc">nrea</span><span class="err">chable=</span><span class="mi">0</span><span class="w">    </span><span class="kc">fa</span><span class="err">iled=</span><span class="mi">0</span><span class="w">    </span><span class="err">skipped=</span><span class="mi">0</span><span class="w">    </span><span class="err">rescued=</span><span class="mi">0</span><span class="w">    </span><span class="err">ig</span><span class="kc">n</span><span class="err">ored=</span><span class="mi">0</span><span class="w">   </span>
<span class="mf">192.168.1.136</span><span class="w">              </span><span class="p">:</span><span class="w"> </span><span class="err">ok=</span><span class="mi">13</span><span class="w">   </span><span class="err">cha</span><span class="kc">n</span><span class="err">ged=</span><span class="mi">5</span><span class="w">    </span><span class="err">u</span><span class="kc">nrea</span><span class="err">chable=</span><span class="mi">0</span><span class="w">    </span><span class="kc">fa</span><span class="err">iled=</span><span class="mi">0</span><span class="w">    </span><span class="err">skipped=</span><span class="mi">0</span><span class="w">    </span><span class="err">rescued=</span><span class="mi">0</span><span class="w">    </span><span class="err">ig</span><span class="kc">n</span><span class="err">ored=</span><span class="mi">0</span><span class="w">   </span>
<span class="mf">192.168.1.166</span><span class="w">              </span><span class="p">:</span><span class="w"> </span><span class="err">ok=</span><span class="mi">13</span><span class="w">   </span><span class="err">cha</span><span class="kc">n</span><span class="err">ged=</span><span class="mi">5</span><span class="w">    </span><span class="err">u</span><span class="kc">nrea</span><span class="err">chable=</span><span class="mi">0</span><span class="w">    </span><span class="kc">fa</span><span class="err">iled=</span><span class="mi">0</span><span class="w">    </span><span class="err">skipped=</span><span class="mi">0</span><span class="w">    </span><span class="err">rescued=</span><span class="mi">0</span><span class="w">    </span><span class="err">ig</span><span class="kc">n</span><span class="err">ored=</span><span class="mi">0</span><span class="w">   </span>
<span class="mf">192.168.1.246</span><span class="w">              </span><span class="p">:</span><span class="w"> </span><span class="err">ok=</span><span class="mi">13</span><span class="w">   </span><span class="err">cha</span><span class="kc">n</span><span class="err">ged=</span><span class="mi">5</span><span class="w">    </span><span class="err">u</span><span class="kc">nrea</span><span class="err">chable=</span><span class="mi">0</span><span class="w">    </span><span class="kc">fa</span><span class="err">iled=</span><span class="mi">0</span><span class="w">    </span><span class="err">skipped=</span><span class="mi">0</span><span class="w">    </span><span class="err">rescued=</span><span class="mi">0</span><span class="w">    </span><span class="err">ig</span><span class="kc">n</span><span class="err">ored=</span><span class="mi">0</span><span class="w">   </span>
<span class="mf">192.168.1.250</span><span class="w">              </span><span class="p">:</span><span class="w"> </span><span class="err">ok=</span><span class="mi">13</span><span class="w">   </span><span class="err">cha</span><span class="kc">n</span><span class="err">ged=</span><span class="mi">5</span><span class="w">    </span><span class="err">u</span><span class="kc">nrea</span><span class="err">chable=</span><span class="mi">0</span><span class="w">    </span><span class="kc">fa</span><span class="err">iled=</span><span class="mi">0</span><span class="w">    </span><span class="err">skipped=</span><span class="mi">0</span><span class="w">    </span><span class="err">rescued=</span><span class="mi">0</span><span class="w">    </span><span class="err">ig</span><span class="kc">n</span><span class="err">ored=</span><span class="mi">0</span><span class="w">   </span>
<span class="mf">192.168.1.33</span><span class="w">               </span><span class="p">:</span><span class="w"> </span><span class="err">ok=</span><span class="mi">13</span><span class="w">   </span><span class="err">cha</span><span class="kc">n</span><span class="err">ged=</span><span class="mi">5</span><span class="w">    </span><span class="err">u</span><span class="kc">nrea</span><span class="err">chable=</span><span class="mi">0</span><span class="w">    </span><span class="kc">fa</span><span class="err">iled=</span><span class="mi">0</span><span class="w">    </span><span class="err">skipped=</span><span class="mi">0</span><span class="w">    </span><span class="err">rescued=</span><span class="mi">0</span><span class="w">    </span><span class="err">ig</span><span class="kc">n</span><span class="err">ored=</span><span class="mi">0</span><span class="w">   </span>
<span class="mf">192.168.1.4</span><span class="w">                </span><span class="p">:</span><span class="w"> </span><span class="err">ok=</span><span class="mi">13</span><span class="w">   </span><span class="err">cha</span><span class="kc">n</span><span class="err">ged=</span><span class="mi">5</span><span class="w">    </span><span class="err">u</span><span class="kc">nrea</span><span class="err">chable=</span><span class="mi">0</span><span class="w">    </span><span class="kc">fa</span><span class="err">iled=</span><span class="mi">0</span><span class="w">    </span><span class="err">skipped=</span><span class="mi">0</span><span class="w">    </span><span class="err">rescued=</span><span class="mi">0</span><span class="w">    </span><span class="err">ig</span><span class="kc">n</span><span class="err">ored=</span><span class="mi">0</span><span class="w">   </span>
<span class="mf">192.168.1.93</span><span class="w">               </span><span class="p">:</span><span class="w"> </span><span class="err">ok=</span><span class="mi">13</span><span class="w">   </span><span class="err">cha</span><span class="kc">n</span><span class="err">ged=</span><span class="mi">5</span><span class="w">    </span><span class="err">u</span><span class="kc">nrea</span><span class="err">chable=</span><span class="mi">0</span><span class="w">    </span><span class="kc">fa</span><span class="err">iled=</span><span class="mi">0</span><span class="w">    </span><span class="err">skipped=</span><span class="mi">0</span><span class="w">    </span><span class="err">rescued=</span><span class="mi">0</span><span class="w">    </span><span class="err">ig</span><span class="kc">n</span><span class="err">ored=</span><span class="mi">0</span><span class="w">   </span>
<span class="mf">192.168.100.15</span><span class="w">             </span><span class="p">:</span><span class="w"> </span><span class="err">ok=</span><span class="mi">13</span><span class="w">   </span><span class="err">cha</span><span class="kc">n</span><span class="err">ged=</span><span class="mi">5</span><span class="w">    </span><span class="err">u</span><span class="kc">nrea</span><span class="err">chable=</span><span class="mi">0</span><span class="w">    </span><span class="kc">fa</span><span class="err">iled=</span><span class="mi">0</span><span class="w">    </span><span class="err">skipped=</span><span class="mi">0</span><span class="w">    </span><span class="err">rescued=</span><span class="mi">0</span><span class="w">    </span><span class="err">ig</span><span class="kc">n</span><span class="err">ored=</span><span class="mi">0</span><span class="w">   </span>
<span class="mf">192.168.100.5</span><span class="w">              </span><span class="p">:</span><span class="w"> </span><span class="err">ok=</span><span class="mi">12</span><span class="w">   </span><span class="err">cha</span><span class="kc">n</span><span class="err">ged=</span><span class="mi">5</span><span class="w">    </span><span class="err">u</span><span class="kc">nrea</span><span class="err">chable=</span><span class="mi">0</span><span class="w">    </span><span class="kc">fa</span><span class="err">iled=</span><span class="mi">0</span><span class="w">    </span><span class="err">skipped=</span><span class="mi">1</span><span class="w">    </span><span class="err">rescued=</span><span class="mi">0</span><span class="w">    </span><span class="err">ig</span><span class="kc">n</span><span class="err">ored=</span><span class="mi">1</span><span class="w">   </span>
<span class="mf">192.168.2.6</span><span class="w">                </span><span class="p">:</span><span class="w"> </span><span class="err">ok=</span><span class="mi">13</span><span class="w">   </span><span class="err">cha</span><span class="kc">n</span><span class="err">ged=</span><span class="mi">5</span><span class="w">    </span><span class="err">u</span><span class="kc">nrea</span><span class="err">chable=</span><span class="mi">0</span><span class="w">    </span><span class="kc">fa</span><span class="err">iled=</span><span class="mi">0</span><span class="w">    </span><span class="err">skipped=</span><span class="mi">0</span><span class="w">    </span><span class="err">rescued=</span><span class="mi">0</span><span class="w">    </span><span class="err">ig</span><span class="kc">n</span><span class="err">ored=</span><span class="mi">0</span><span class="w">   </span>
<span class="mf">192.168.200.7</span><span class="w">              </span><span class="p">:</span><span class="w"> </span><span class="err">ok=</span><span class="mi">13</span><span class="w">   </span><span class="err">cha</span><span class="kc">n</span><span class="err">ged=</span><span class="mi">5</span><span class="w">    </span><span class="err">u</span><span class="kc">nrea</span><span class="err">chable=</span><span class="mi">0</span><span class="w">    </span><span class="kc">fa</span><span class="err">iled=</span><span class="mi">0</span><span class="w">    </span><span class="err">skipped=</span><span class="mi">0</span><span class="w">    </span><span class="err">rescued=</span><span class="mi">0</span><span class="w">    </span><span class="err">ig</span><span class="kc">n</span><span class="err">ored=</span><span class="mi">0</span><span class="w">   </span>
<span class="mf">192.168.200.8</span><span class="w">              </span><span class="p">:</span><span class="w"> </span><span class="err">ok=</span><span class="mi">13</span><span class="w">   </span><span class="err">cha</span><span class="kc">n</span><span class="err">ged=</span><span class="mi">5</span><span class="w">    </span><span class="err">u</span><span class="kc">nrea</span><span class="err">chable=</span><span class="mi">0</span><span class="w">    </span><span class="kc">fa</span><span class="err">iled=</span><span class="mi">0</span><span class="w">    </span><span class="err">skipped=</span><span class="mi">0</span><span class="w">    </span><span class="err">rescued=</span><span class="mi">0</span><span class="w">    </span><span class="err">ig</span><span class="kc">n</span><span class="err">ored=</span><span class="mi">0</span><span class="w">   </span>
<span class="err">bi</span><span class="kc">n</span><span class="err">d.home.com</span><span class="w">              </span><span class="p">:</span><span class="w"> </span><span class="err">ok=</span><span class="mi">13</span><span class="w">   </span><span class="err">cha</span><span class="kc">n</span><span class="err">ged=</span><span class="mi">5</span><span class="w">    </span><span class="err">u</span><span class="kc">nrea</span><span class="err">chable=</span><span class="mi">0</span><span class="w">    </span><span class="kc">fa</span><span class="err">iled=</span><span class="mi">0</span><span class="w">    </span><span class="err">skipped=</span><span class="mi">0</span><span class="w">    </span><span class="err">rescued=</span><span class="mi">0</span><span class="w">    </span><span class="err">ig</span><span class="kc">n</span><span class="err">ored=</span><span class="mi">0</span><span class="w">   </span>
<span class="err">s</span><span class="kc">te</span><span class="err">pca.home.com</span><span class="w">            </span><span class="p">:</span><span class="w"> </span><span class="err">ok=</span><span class="mi">13</span><span class="w">   </span><span class="err">cha</span><span class="kc">n</span><span class="err">ged=</span><span class="mi">5</span><span class="w">    </span><span class="err">u</span><span class="kc">nrea</span><span class="err">chable=</span><span class="mi">0</span><span class="w">    </span><span class="kc">fa</span><span class="err">iled=</span><span class="mi">0</span><span class="w">    </span><span class="err">skipped=</span><span class="mi">0</span><span class="w">    </span><span class="err">rescued=</span><span class="mi">0</span><span class="w">    </span><span class="err">ig</span><span class="kc">n</span><span class="err">ored=</span><span class="mi">0</span><span class="w">   </span>
<span class="kc">trf</span><span class="err">k.home.com</span><span class="w">              </span><span class="p">:</span><span class="w"> </span><span class="err">ok=</span><span class="mi">13</span><span class="w">   </span><span class="err">cha</span><span class="kc">n</span><span class="err">ged=</span><span class="mi">5</span><span class="w">    </span><span class="err">u</span><span class="kc">nrea</span><span class="err">chable=</span><span class="mi">0</span><span class="w">    </span><span class="kc">fa</span><span class="err">iled=</span><span class="mi">0</span><span class="w">    </span><span class="err">skipped=</span><span class="mi">0</span><span class="w">    </span><span class="err">rescued=</span><span class="mi">0</span><span class="w">    </span><span class="err">ig</span><span class="kc">n</span><span class="err">ored=</span><span class="mi">0</span><span class="w">   </span>
<span class="err">u</span><span class="kc">n</span><span class="err">bou</span><span class="kc">n</span><span class="err">d.home.com</span><span class="w">           </span><span class="p">:</span><span class="w"> </span><span class="err">ok=</span><span class="mi">13</span><span class="w">   </span><span class="err">cha</span><span class="kc">n</span><span class="err">ged=</span><span class="mi">5</span><span class="w">    </span><span class="err">u</span><span class="kc">nrea</span><span class="err">chable=</span><span class="mi">0</span><span class="w">    </span><span class="kc">fa</span><span class="err">iled=</span><span class="mi">0</span><span class="w">    </span><span class="err">skipped=</span><span class="mi">0</span><span class="w">    </span><span class="err">rescued=</span><span class="mi">0</span><span class="w">    </span><span class="err">ig</span><span class="kc">n</span><span class="err">ored=</span><span class="mi">0</span><span class="w">   </span>
<span class="err">up</span><span class="kc">t</span><span class="err">imek.home.com</span><span class="w">           </span><span class="p">:</span><span class="w"> </span><span class="err">ok=</span><span class="mi">13</span><span class="w">   </span><span class="err">cha</span><span class="kc">n</span><span class="err">ged=</span><span class="mi">5</span><span class="w">    </span><span class="err">u</span><span class="kc">nrea</span><span class="err">chable=</span><span class="mi">0</span><span class="w">    </span><span class="kc">fa</span><span class="err">iled=</span><span class="mi">0</span><span class="w">    </span><span class="err">skipped=</span><span class="mi">0</span><span class="w">    </span><span class="err">rescued=</span><span class="mi">0</span><span class="w">    </span><span class="err">ig</span><span class="kc">n</span><span class="err">ored=</span><span class="mi">0</span><span class="w">   </span>
<span class="err">wazuh.home.com</span><span class="w">             </span><span class="p">:</span><span class="w"> </span><span class="err">ok=</span><span class="mi">13</span><span class="w">   </span><span class="err">cha</span><span class="kc">n</span><span class="err">ged=</span><span class="mi">5</span><span class="w">    </span><span class="err">u</span><span class="kc">nrea</span><span class="err">chable=</span><span class="mi">0</span><span class="w">    </span><span class="kc">fa</span><span class="err">iled=</span><span class="mi">0</span><span class="w">    </span><span class="err">skipped=</span><span class="mi">0</span><span class="w">    </span><span class="err">rescued=</span><span class="mi">0</span><span class="w">    </span><span class="err">ig</span><span class="kc">n</span><span class="err">ored=</span><span class="mi">0</span><span class="w">   </span>
<span class="err">web.home.com</span><span class="w">               </span><span class="p">:</span><span class="w"> </span><span class="err">ok=</span><span class="mi">13</span><span class="w">   </span><span class="err">cha</span><span class="kc">n</span><span class="err">ged=</span><span class="mi">5</span><span class="w">    </span><span class="err">u</span><span class="kc">nrea</span><span class="err">chable=</span><span class="mi">0</span><span class="w">    </span><span class="kc">fa</span><span class="err">iled=</span><span class="mi">0</span><span class="w">    </span><span class="err">skipped=</span><span class="mi">0</span><span class="w">    </span><span class="err">rescued=</span><span class="mi">0</span><span class="w">    </span><span class="err">ig</span><span class="kc">n</span><span class="err">ored=</span><span class="mi">0</span>
</code></pre></div><a class="headerlink" href="#play-audit-system-info-task-gathering-facts-ok-webhomecom-ok-1921681136-ok-unboundhomecom-ok-bindhomecom-ok-1921681250-ok-uptimekhomecom-ok-19216814-ok-stepcahomecom-ok-trfkhomecom-ok-wazuhhomecom-ok-192168193-ok-19216810015-ok-1921681246-ok-192168133-ok-19216826-ok-1921682008-ok-1921682007-ok-1921681126-ok-1921681109-ok-1921681166-ok-1921681005-task-show-disk-usage-ok-webhomecom-disk_usagestdout_lines-filesystem-size-used-avail-use-mounted-on-devloop0-16g-12g-32g-79-none-492k-40k-488k-1-dev-efivarfs-192k-180k-76k-96-sysfirmwareefiefivars-tmpfs-47g-0-47g-0-devshm-tmpfs-19g-156k-19g-1-run-tmpfs-50m-0-50m-0-runlock-tmpfs-47g-124k-47g-1-tmp-tmpfs-94g-80k-94g-1-runuser0-tmpfs-94g-80k-94g-1-runuser1001-task-show-ip-address-info-ok-webhomecom-ip_infostdout_lines-1-lo-loopbackuplower_up-mtu-65536-qdisc-noqueue-state-unknown-group-default-qlen-1000-linkloopback-000000000000-brd-000000000000-inet-1270018-scope-host-lo-valid_lft-forever-preferred_lft-forever-inet6-1128-scope-host-noprefixroute-valid_lft-forever-preferred_lft-forever-2-eth0if76-broadcastmulticastuplower_up-mtu-1500-qdisc-noqueue-state-up-group-default-qlen-1000-linkether-bc2411f9a08c-brd-ffffffffffff-link-netnsid-0-inet-192168110824-brd-1921681255-scope-global-eth0-valid_lft-forever-preferred_lft-forever-inet6-fe80be2411fffef9a08c64-scope-link-proto-kernel_ll-valid_lft-forever-preferred_lft-forever-task-show-routing-table-ok-webhomecom-route_infostdout_lines-default-via-19216811-dev-eth0-proto-static-1921681024-dev-eth0-proto-kernel-scope-link-src-1921681108-task-show-hostname-ok-webhomecom-host_namestdout-apache-ubuntu-task-show-nameservers-ok-webhomecom-resolv_confstdout_lines-begin-pve-search-homecom-nameserver-1921681250-end-pve-task-show-authorized-ssh-keys-ok-webhomecom-msg-ssh-ed25519-rootansible-play-recap-1921681109-ok13-changed5-unreachable0-failed0-skipped0-rescued0-ignored0-1921681126-ok13-changed5-unreachable0-failed0-skipped0-rescued0-ignored0-1921681136-ok13-changed5-unreachable0-failed0-skipped0-rescued0-ignored0-1921681166-ok13-changed5-unreachable0-failed0-skipped0-rescued0-ignored0-1921681246-ok13-changed5-unreachable0-failed0-skipped0-rescued0-ignored0-1921681250-ok13-changed5-unreachable0-failed0-skipped0-rescued0-ignored0-192168133-ok13-changed5-unreachable0-failed0-skipped0-rescued0-ignored0-19216814-ok13-changed5-unreachable0-failed0-skipped0-rescued0-ignored0-192168193-ok13-changed5-unreachable0-failed0-skipped0-rescued0-ignored0-19216810015-ok13-changed5-unreachable0-failed0-skipped0-rescued0-ignored0-1921681005-ok12-changed5-unreachable0-failed0-skipped1-rescued0-ignored1-19216826-ok13-changed5-unreachable0-failed0-skipped0-rescued0-ignored0-1921682007-ok13-changed5-unreachable0-failed0-skipped0-rescued0-ignored0-1921682008-ok13-changed5-unreachable0-failed0-skipped0-rescued0-ignored0-bindhomecom-ok13-changed5-unreachable0-failed0-skipped0-rescued0-ignored0-stepcahomecom-ok13-changed5-unreachable0-failed0-skipped0-rescued0-ignored0-trfkhomecom-ok13-changed5-unreachable0-failed0-skipped0-rescued0-ignored0-unboundhomecom-ok13-changed5-unreachable0-failed0-skipped0-rescued0-ignored0-uptimekhomecom-ok13-changed5-unreachable0-failed0-skipped0-rescued0-ignored0-wazuhhomecom-ok13-changed5-unreachable0-failed0-skipped0-rescued0-ignored0-webhomecom-ok13-changed5-unreachable0-failed0-skipped0-rescued0-ignored0" title="Permanent link">&para;</a></h2>
<h3 id="53-workflow-2-threat-intelligence-aggregation">5.3 Workflow 2: Threat Intelligence Aggregation<a class="headerlink" href="#53-workflow-2-threat-intelligence-aggregation" title="Permanent link">&para;</a></h3>
<p><strong>Purpose:</strong> Daily ingestion and distribution of curated cybersecurity threat intelligence.</p>
<p>This workflow runs daily to ingest and distribute curated threat intelligence from multiple cybersecurity RSS feeds. It supports situational awareness and IOC enrichment across the lab environment.</p>
<p><strong>Workflow Summary:</strong></p>
<ul>
<li>Scheduled Execution: Triggered daily via n8n's Cron node</li>
<li>RSS Feed Polling: Pulls entries from a curated list of cybersecurity sources</li>
<li>Feed Limiting: Filters each feed to the 5 most recent entries to reduce noise and maintain relevance</li>
<li>Discord Notification: Formats and sends the aggregated feed summary to a dedicated Discord channel on the private lab server for daily review</li>
<li>The NIST RSS feed is also fed through ChatGPT for a summary notification in Discord</li>
</ul>
<h3 id="workflow-nodes_1">Workflow Nodes<a class="headerlink" href="#workflow-nodes_1" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Node Type</th>
<th>Configuration</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td>Schedule Trigger</td>
<td>Cron: 0 8 * * * (Daily 8 AM)</td>
<td>Daily execution</td>
</tr>
<tr>
<td>RSS Feed Reader</td>
<td>URLs: CISA Alerts; NIST NVD; Krebs on Security; Threat Post; BleepingComputer</td>
<td>Ingest threat intel</td>
</tr>
<tr>
<td>Filter Node</td>
<td>Limit each feed to 5 most recent</td>
<td>Reduce noise</td>
</tr>
<tr>
<td>Merge Node</td>
<td>Combine all feeds</td>
<td>Aggregate data</td>
</tr>
<tr>
<td>OpenAI Node</td>
<td>Summarize NIST feed with ChatGPT</td>
<td>AI-powered summary</td>
</tr>
<tr>
<td>Format Node</td>
<td>Create Discord embed message</td>
<td>Visual formatting</td>
</tr>
<tr>
<td>Discord Webhook</td>
<td>Post to #threat-intel channel</td>
<td>Distribute to team</td>
</tr>
</tbody>
</table>
<figure class=image-large>
      <img src="/Career_Projects/assets/screenshots/n8n-feed.png" alt="n8n TI Workflow">
      <figcaption style="font-size:0.9rem; color:var(--md-secondary-text-color); margin-top:0.5rem;">
        n8n Threat Intelligence Workflow.
      </figcaption>
    </figure>

<p><strong>ChatGPT Integration:</strong></p>
<p><strong>Prompt:</strong> "Summarize the following NIST vulnerability in 2-3 sentences suitable for a security team. Focus on severity, affected systems, and recommended actions: {{ $json.content }}"</p>
<p><strong>Response Example:</strong> "CVE-2024-12345: Critical remote code execution vulnerability in Apache Log4j 2.x. Affects versions 2.0-2.17.0. Immediate patching recommended; workaround available via environment variable. CVSS 9.8/10."</p>
<p><strong>Workflow Benefits:</strong></p>
<ul>
<li>Centralized threat intelligence (15 sources → 1 channel)</li>
<li>AI-powered summarization reduces information overload</li>
<li>Daily cadence ensures timely awareness of emerging threats</li>
<li>Supports incident response and vulnerability management</li>
</ul>
<p><strong>Workflow Error Handling:</strong></p>
<ul>
<li>RSS Feed Timeout: Skip feed, log error, continue</li>
<li>Discord Webhook Failure: Send email fallback alert</li>
<li>All Errors: Logged to n8n execution history</li>
</ul>
<figure class=image-large>
      <img src="/Career_Projects/assets/screenshots/n8n-nist.png" alt="OSINT Feed">
      <figcaption style="font-size:0.9rem; color:var(--md-secondary-text-color); margin-top:0.5rem;">
        Discord Threat Intel Feed and ChatGPT Summary.
      </figcaption>
    </figure>

<hr />
<h2 id="6-scripting-for-advanced-automation">6. Scripting for Advanced Automation<a class="headerlink" href="#6-scripting-for-advanced-automation" title="Permanent link">&para;</a></h2>
<h3 id="script-development-strategy">Script Development Strategy<a class="headerlink" href="#script-development-strategy" title="Permanent link">&para;</a></h3>
<p>Custom scripts supplement configuration management tools for tasks requiring complex logic, performance optimization, or specialized functionality. All scripts are version-controlled in Git, documented with inline comments, and integrated into broader automation workflows.</p>
<p><strong>Security Impact</strong></p>
<ul>
<li>Complex security operations automated where configuration‑management tools lack native functionality</li>
<li>Performance‑critical tasks (log parsing, threat‑intelligence queries) optimized beyond built‑in tool capabilities</li>
<li>Security tool APIs integrated through custom automation wrappers for expanded functionality</li>
<li>Rapid prototyping enables validation of security concepts before production‑grade implementation</li>
</ul>
<p><strong>Deployment Rationale:</strong> While Ansible/Terraform handle declarative configuration, procedural logic (API rate-limiting, stateful workflows, real-time processing) requires traditional scripting. Enterprise environments use scripts for custom integrations, API gateways, and performance-critical operations. This demonstrates ability to select appropriate automation tools—declarative vs. imperative—based on task requirements.</p>
<p><strong>Architecture Principles Alignment</strong></p>
<ul>
<li><strong>Defense in Depth:</strong> Scripts validate input parameters; error handling prevents cascading failures; execution logs audited for anomalies</li>
<li><strong>Secure by Design:</strong> No hardcoded credentials (environment variables or secret managers); input sanitization prevents injection attacks; least-privilege execution (non-root where possible)</li>
<li><strong>Zero Trust:</strong> Every script execution logged with user/timestamp; API calls authenticated via short-lived tokens; output validation before downstream processing</li>
</ul>
<h3 id="script-language-selection-criteria">Script Language Selection Criteria<a class="headerlink" href="#script-language-selection-criteria" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Language</th>
<th>Use Cases</th>
<th>Advantages</th>
</tr>
</thead>
<tbody>
<tr>
<td>Bash</td>
<td>Linux system administration; cron jobs</td>
<td>Native; fast; no dependencies</td>
</tr>
<tr>
<td>PowerShell</td>
<td>Windows management; AD operations</td>
<td>Deep Windows integration; objects</td>
</tr>
<tr>
<td>Python</td>
<td>API integration; data processing; ML</td>
<td>Rich libraries; cross-platform</td>
</tr>
</tbody>
</table>
<hr />
<h3 id="61-powershell-and-bash-scripting">6.1 PowerShell and Bash Scripting<a class="headerlink" href="#61-powershell-and-bash-scripting" title="Permanent link">&para;</a></h3>
<p>Custom automation scripts are developed in both PowerShell (for Windows systems) and Bash (for Linux systems) to handle repetitive administrative tasks, enforce configuration standards, and respond to system events. These scripts automate activities such as user account provisioning, log rotation, backup verification, certificate renewal checks, and security baseline enforcement. PowerShell scripts leverage native Windows management frameworks like Active Directory modules and WMI, while Bash scripts utilize standard Unix utilities and interact with system APIs. Scripts are version-controlled in GitHub alongside infrastructure code, enabling rollback capability and documentation of automation logic.</p>
<h4 id="bash-script-example-backup-automation">Bash Script Example: Backup Automation<a class="headerlink" href="#bash-script-example-backup-automation" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>
<span class="c1">#</span>
<span class="c1"># backup_web.sh - Versioned rsync backup with validation</span>
<span class="c1"># Usage: backup_web.sh &lt;source&gt; &lt;target&gt;</span>
<span class="c1"># Example: backup_web.sh /var/www/lab /backup</span>
<span class="c1">#</span>
<span class="c1"># Exit Codes:</span>
<span class="c1">#   0 - Success</span>
<span class="c1">#   1 - Invalid arguments</span>
<span class="c1">#   2 - Missing dependency</span>
<span class="c1">#   3 - Rsync failed</span>
<span class="nb">set</span><span class="w"> </span>-euo<span class="w"> </span>pipefail<span class="w">  </span><span class="c1"># Exit on error, undefined vars, pipe failures</span>

<span class="c1"># check to make sure the user has entrered exactly two arguments.</span>
<span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="nv">$#</span><span class="w"> </span>-ne<span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="o">]</span>
<span class="k">then</span><span class="w">    </span>
<span class="w">    </span>/usr/bin/echo<span class="w"> </span><span class="s2">&quot;Usage: backup.sh &lt;source_directory&gt; &lt;target_directory&gt;&quot;</span>
<span class="w">    </span>/usr/bin/echo<span class="w"> </span><span class="s2">&quot;Please try again.&quot;</span>
<span class="w">    </span><span class="nb">exit</span><span class="w"> </span><span class="m">1</span>
<span class="k">fi</span>
<span class="nv">SOURCE</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span>
<span class="nv">TARGET</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$2</span><span class="s2">&quot;</span>

<span class="c1"># Validate paths (prevent directory traversal)</span>
<span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span>!<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$SOURCE</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">=</span>~<span class="w"> </span>^/<span class="o">[</span>a-zA-Z0-9/_-<span class="o">]</span>+<span class="nv">$RetryPContinuebash</span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Error: Invalid source path format&quot;</span>
<span class="w">    </span><span class="nb">exit</span><span class="w"> </span><span class="m">1</span>
<span class="k">fi</span>

<span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span>!<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$TARGET</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">=</span>~<span class="w"> </span>^/<span class="o">[</span>a-zA-Z0-9/_-<span class="o">]</span>+$<span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Error: Invalid target path format&quot;</span>
<span class="w">    </span><span class="nb">exit</span><span class="w"> </span><span class="m">1</span>
<span class="k">fi</span>

<span class="c1">#check to see if rsync is installed</span>
<span class="k">if</span><span class="w"> </span>!<span class="w"> </span><span class="nb">command</span><span class="w"> </span>-v<span class="w"> </span>rsync<span class="w"> </span>&gt;<span class="w"> </span>/dev/null<span class="w"> </span><span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span>
<span class="k">then</span>
<span class="w">    </span>/usr/bin/echo<span class="w"> </span><span class="s2">&quot;This script requires rsync to be installed.&quot;</span>
<span class="w">    </span>/usr/bin/echo<span class="w"> </span><span class="s2">&quot;Please install the package and run the script again.&quot;</span>
<span class="w">    </span><span class="nb">exit</span><span class="w"> </span><span class="m">2</span>
<span class="k">fi</span>
<span class="c1"># Verify source exists</span>
<span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>!<span class="w"> </span>-d<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$SOURCE</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">    </span>/usr/bin/echo<span class="w"> </span><span class="s2">&quot;Error: Source directory does not exist: </span><span class="nv">$SOURCE</span><span class="s2">&quot;</span>
<span class="w">    </span><span class="nb">exit</span><span class="w"> </span><span class="m">1</span>
<span class="k">fi</span>

<span class="c1"># Create target if needed</span>
mkdir<span class="w"> </span>-p<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$TARGET</span><span class="s2">&quot;</span>

<span class="c1"># Generate timestamp</span>
<span class="nv">TIMESTAMP</span><span class="o">=</span><span class="k">$(</span>date<span class="w"> </span>+%Y-%m-%d_%H-%M-%S<span class="k">)</span>
<span class="nv">BACKUP_DATE</span><span class="o">=</span><span class="k">$(</span>date<span class="w"> </span>+%Y-%m-%d<span class="k">)</span>
<span class="nv">LOG_FILE</span><span class="o">=</span><span class="s2">&quot;/var/log/backup_</span><span class="si">${</span><span class="nv">BACKUP_DATE</span><span class="si">}</span><span class="s2">.log&quot;</span>

<span class="c1"># Rsync options</span>
<span class="nv">RSYNC_OPTS</span><span class="o">=(</span>
<span class="w">    </span>-avz<span class="w">                                    </span><span class="c1"># Archive, verbose, compress</span>
<span class="w">    </span>--delete<span class="w">                                </span><span class="c1"># Remove deleted files</span>
<span class="w">    </span>--backup<span class="w">                                </span><span class="c1"># Backup changed files</span>
<span class="w">    </span>--backup-dir<span class="o">=</span><span class="s2">&quot;</span><span class="nv">$TARGET</span><span class="s2">/versions/</span><span class="nv">$TIMESTAMP</span><span class="s2">&quot;</span><span class="w">  </span><span class="c1"># Versioned backups</span>
<span class="w">    </span>--exclude<span class="o">=</span><span class="s1">&#39;*.tmp&#39;</span><span class="w">                       </span><span class="c1"># Exclude temp files</span>
<span class="w">    </span>--exclude<span class="o">=</span><span class="s1">&#39;.git&#39;</span><span class="w">                        </span><span class="c1"># Exclude version control</span>
<span class="w">    </span>--log-file<span class="o">=</span><span class="s2">&quot;</span><span class="nv">$LOG_FILE</span><span class="s2">&quot;</span><span class="w">                  </span><span class="c1"># Detailed logging</span>
<span class="w">    </span>--stats<span class="w">                                 </span><span class="c1"># Show transfer statistics</span>
<span class="o">)</span>

<span class="c1"># Log start</span>
/usr/bin/echo<span class="w"> </span><span class="s2">&quot;=== Backup started at </span><span class="k">$(</span>date<span class="k">)</span><span class="s2"> ===&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>tee<span class="w"> </span>-a<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$LOG_FILE</span><span class="s2">&quot;</span>
logger<span class="w"> </span>-t<span class="w"> </span>backup_web<span class="w"> </span><span class="s2">&quot;Starting backup: </span><span class="nv">$SOURCE</span><span class="s2"> -&gt; </span><span class="nv">$TARGET</span><span class="s2">&quot;</span>

<span class="c1"># Execute rsync</span>
<span class="k">if</span><span class="w"> </span>rsync<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">RSYNC_OPTS</span><span class="p">[@]</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$SOURCE</span><span class="s2">/&quot;</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$TARGET</span><span class="s2">/current/&quot;</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">    </span>/usr/bin/echo<span class="w"> </span><span class="s2">&quot;=== Backup completed successfully at </span><span class="k">$(</span>date<span class="k">)</span><span class="s2"> ===&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>tee<span class="w"> </span>-a<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$LOG_FILE</span><span class="s2">&quot;</span>
<span class="w">    </span>logger<span class="w"> </span>-t<span class="w"> </span>backup_web<span class="w"> </span><span class="s2">&quot;SUCCESS: Backup completed&quot;</span>

<span class="w">    </span><span class="c1"># Calculate backup size</span>
<span class="w">    </span><span class="nv">BACKUP_SIZE</span><span class="o">=</span><span class="k">$(</span>du<span class="w"> </span>-sh<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$TARGET</span><span class="s2">/current&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>cut<span class="w"> </span>-f1<span class="k">)</span>
<span class="w">    </span>/usr/bin/echo<span class="w"> </span><span class="s2">&quot;Backup size: </span><span class="nv">$BACKUP_SIZE</span><span class="s2">&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>tee<span class="w"> </span>-a<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$LOG_FILE</span><span class="s2">&quot;</span>

<span class="w">    </span><span class="c1"># Retention: Keep only last 7 version directories</span>
<span class="w">    </span>find<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$TARGET</span><span class="s2">/versions/&quot;</span><span class="w"> </span>-maxdepth<span class="w"> </span><span class="m">1</span><span class="w"> </span>-type<span class="w"> </span>d<span class="w"> </span>-mtime<span class="w"> </span>+7<span class="w"> </span>-exec<span class="w"> </span>rm<span class="w"> </span>-rf<span class="w"> </span><span class="o">{}</span><span class="w"> </span><span class="se">\;</span>

<span class="w">    </span><span class="nb">exit</span><span class="w"> </span><span class="m">0</span>
<span class="k">else</span>
<span class="w">    </span><span class="nv">RSYNC_EXIT</span><span class="o">=</span><span class="nv">$?</span>
<span class="w">    </span>/usr/bin/echo<span class="w"> </span><span class="s2">&quot;=== Backup FAILED at </span><span class="k">$(</span>date<span class="k">)</span><span class="s2"> with exit code </span><span class="nv">$RSYNC_EXIT</span><span class="s2"> ===&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>tee<span class="w"> </span>-a<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$LOG_FILE</span><span class="s2">&quot;</span>
<span class="w">    </span>logger<span class="w"> </span>-t<span class="w"> </span>backup_web<span class="w"> </span><span class="s2">&quot;FAILED: rsync exited with code </span><span class="nv">$RSYNC_EXIT</span><span class="s2">&quot;</span>
<span class="w">    </span><span class="nb">exit</span><span class="w"> </span><span class="m">3</span>
<span class="k">fi</span>
</code></pre></div>
<p>This Bash script is designed to perform a backup using rsync, with versioned backups stored by date. It validates input, checks for dependencies, and logs the simulated operation.</p>
<p><strong>Script:</strong> /usr/local/bin/backup_web.sh</p>
<p><strong>Purpose:</strong> Incremental rsync backup with versioning and logging</p>
<table>
<thead>
<tr>
<th>Line(s)</th>
<th>Purpose</th>
<th>Explanation</th>
</tr>
</thead>
<tbody>
<tr>
<td>#!/bin/bash</td>
<td>Script interpreter</td>
<td>Ensures the script runs using Bash</td>
</tr>
<tr>
<td>if [ $# -ne 2 ]</td>
<td>Argument check</td>
<td>Verifies that exactly two arguments are provided</td>
</tr>
<tr>
<td>echo "Usage:..."</td>
<td>Usage message</td>
<td>Informs the user of correct syntax if arguments are missing</td>
</tr>
<tr>
<td>exit 1</td>
<td>Exit on error</td>
<td>Terminates with exit code 1 for incorrect usage</td>
</tr>
<tr>
<td>command -v rsync</td>
<td>Dependency check</td>
<td>Verifies that rsync is installed and available in $PATH</td>
</tr>
<tr>
<td>exit 2</td>
<td>Exit on missing dependency</td>
<td>Terminates with exit code 2 if rsync is not found</td>
</tr>
<tr>
<td>current_date=$(date +%Y-%m-%d)</td>
<td>Timestamp</td>
<td>Captures the current date in YYYY-MM-DD format for versioning</td>
</tr>
<tr>
<td>rsync_options=...</td>
<td>Backup options</td>
<td>Sets rsync flags: -a: archive mode; -v: verbose; -b: backup files; --backup-dir: dated subdirectory; --delete: remove obsolete files; --dry-run: simulate</td>
</tr>
<tr>
<td>$(which rsync) ...</td>
<td>Execute rsync</td>
<td>Runs rsync with defined options, syncing from $1 to $2/current</td>
</tr>
<tr>
<td>&gt;&gt; /var/log/backup_$current_date.log</td>
<td>Logging</td>
<td>Appends output to a date-stamped log file for auditability</td>
</tr>
</tbody>
</table>
<h4 id="linux-upgrade-script-overview">Linux Upgrade Script Overview<a class="headerlink" href="#linux-upgrade-script-overview" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>
<span class="nb">set</span><span class="w"> </span>-e

<span class="nv">logfile</span><span class="o">=</span>/var/log/update_script.log
<span class="nv">errorlog</span><span class="o">=</span>/var/log/update_script_errors.log
<span class="nv">hostname</span><span class="o">=</span><span class="k">$(</span>hostname<span class="k">)</span>

/usr/bin/echo<span class="w"> </span><span class="s2">&quot;-------------------START SCRIPT on </span><span class="nv">$hostname</span><span class="s2">-------------------&quot;</span><span class="w"> </span><span class="m">1</span>&gt;&gt;<span class="nv">$logfile</span><span class="w"> </span><span class="m">2</span>&gt;&gt;<span class="nv">$errorlog</span>
check_exit_status<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="nv">$?</span><span class="w"> </span>-ne<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="o">]</span>
<span class="w">    </span><span class="k">then</span>
<span class="w">        </span>/usr/bin/echo<span class="w"> </span><span class="s2">&quot;An error occured, please check the </span><span class="nv">$errorlog</span><span class="s2"> file.&quot;</span>
<span class="w">    </span><span class="k">fi</span><span class="w">    </span>
<span class="o">}</span>

<span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>-d<span class="w"> </span>/etc/apt<span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">    </span><span class="c1"># Debian or Ubuntu</span>
<span class="w">    </span>/usr/bin/echo<span class="w"> </span><span class="s2">&quot;Detected Debian/Ubuntu system&quot;</span>
<span class="w">    </span>/usr/bin/sudo<span class="w"> </span>apt<span class="w"> </span>update<span class="w"> </span><span class="m">1</span>&gt;&gt;<span class="nv">$logfile</span><span class="w"> </span><span class="m">2</span>&gt;&gt;<span class="nv">$errorlog</span>
<span class="w">    </span>check_exit_status
<span class="w">    </span>/usr/bin/sudo<span class="w"> </span>apt<span class="w"> </span>dist-upgrade<span class="w"> </span>-y<span class="w"> </span><span class="m">1</span>&gt;&gt;<span class="nv">$logfile</span><span class="w"> </span><span class="m">2</span>&gt;&gt;<span class="nv">$errorlog</span>
<span class="w">    </span>check_exit_status
<span class="k">elif</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>-f<span class="w"> </span>/etc/redhat-release<span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">    </span><span class="nv">distro</span><span class="o">=</span><span class="k">$(</span>cat<span class="w"> </span>/etc/redhat-release<span class="k">)</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$distro</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">==</span><span class="w"> </span>*<span class="s2">&quot;Fedora&quot;</span>*<span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">        </span>/usr/bin/echo<span class="w"> </span><span class="s2">&quot;Detected Fedora system&quot;</span>
<span class="w">        </span>/usr/bin/sudo<span class="w"> </span>dnf<span class="w"> </span>upgrade<span class="w"> </span>--refresh<span class="w"> </span>-y<span class="w"> </span><span class="c1">#!/bin/bash</span>

<span class="nv">logfile</span><span class="o">=</span>/var/log/update_script.log
<span class="nv">errorlog</span><span class="o">=</span>/var/log/update_script_errors.log


check_exit_status<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="nv">$?</span><span class="w"> </span>-ne<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="o">]</span>
<span class="w">    </span><span class="k">then</span>
<span class="w">        </span>/usr/bin/echo<span class="w"> </span><span class="s2">&quot;An error occured, please check the </span><span class="nv">$errorlog</span><span class="s2"> file.&quot;</span>
<span class="w">    </span><span class="k">fi</span><span class="w">    </span>
<span class="o">}</span>

<span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>-d<span class="w"> </span>/etc/apt<span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">    </span><span class="c1"># Debian or Ubuntu</span>
<span class="w">    </span>/usr/bin/echo<span class="w"> </span><span class="s2">&quot;Detected Debian/Ubuntu system&quot;</span>
<span class="w">    </span>/usr/bin/sudo<span class="w"> </span>apt<span class="w"> </span>update<span class="w"> </span><span class="m">1</span>&gt;&gt;<span class="nv">$logfile</span><span class="w"> </span><span class="m">2</span>&gt;&gt;<span class="nv">$errorlog</span>
<span class="w">    </span>check_exit_status
<span class="w">    </span>/usr/bin/sudo<span class="w"> </span>apt<span class="w"> </span>dist-upgrade<span class="w"> </span>-y<span class="w"> </span><span class="m">1</span>&gt;&gt;<span class="nv">$logfile</span><span class="w"> </span><span class="m">2</span>&gt;&gt;<span class="nv">$errorlog</span>
<span class="w">    </span>check_exit_status
<span class="k">elif</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>-f<span class="w"> </span>/etc/redhat-release<span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">    </span><span class="nv">distro</span><span class="o">=</span><span class="k">$(</span>cat<span class="w"> </span>/etc/redhat-release<span class="k">)</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$distro</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">==</span><span class="w"> </span>*<span class="s2">&quot;Fedora&quot;</span>*<span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">        </span>/usr/bin/echo<span class="w"> </span><span class="s2">&quot;Detected Fedora system&quot;</span>
<span class="w">        </span>/usr/bin/sudo<span class="w"> </span>dnf<span class="w"> </span>upgrade<span class="w"> </span>--refresh<span class="w"> </span>-y<span class="w"> </span><span class="m">1</span>&gt;&gt;<span class="nv">$logfile</span><span class="w"> </span><span class="m">2</span>&gt;&gt;<span class="nv">$errorlog</span>
<span class="w">        </span>check_exit_status<span class="w">   </span>
<span class="w">    </span><span class="k">elif</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$distro</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">==</span><span class="w"> </span>*<span class="s2">&quot;CentOS&quot;</span>*<span class="w"> </span><span class="o">]]</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$distro</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">==</span><span class="w"> </span>*<span class="s2">&quot;Red Hat&quot;</span>*<span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">        </span>/usr/bin/echo<span class="w"> </span><span class="s2">&quot;Detected CentOS or RHEL system&quot;</span>
<span class="w">        </span>/usr/bin/sudo<span class="w"> </span>yum<span class="w"> </span>update<span class="w"> </span>-y<span class="w"> </span><span class="m">1</span>&gt;&gt;<span class="nv">$logfile</span><span class="w"> </span><span class="m">2</span>&gt;&gt;<span class="nv">$errorlog</span>
<span class="w">        </span>check_exit_status<span class="w">      </span>
<span class="w">    </span><span class="k">else</span>
<span class="w">        </span>/usr/bin/echo<span class="w"> </span><span class="s2">&quot;Detected unknown Red Hat-based system&quot;</span>
<span class="w">        </span>/usr/bin/sudo<span class="w"> </span>yum<span class="w"> </span>update<span class="w"> </span>-y<span class="w"> </span><span class="m">1</span>&gt;&gt;<span class="nv">$logfile</span><span class="w"> </span><span class="m">2</span>&gt;&gt;<span class="nv">$errorlog</span>
<span class="w">        </span>check_exit_status<span class="w"> </span>
<span class="w">    </span><span class="k">fi</span>
<span class="k">else</span>
<span class="w">    </span>/usr/bin/echo<span class="w"> </span><span class="s2">&quot;Unsupported or unknown Linux distribution&quot;</span>
<span class="k">fi</span>


<span class="w">        </span>check_exit_status<span class="w">   </span>
<span class="w">    </span><span class="k">elif</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$distro</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">==</span><span class="w"> </span>*<span class="s2">&quot;CentOS&quot;</span>*<span class="w"> </span><span class="o">]]</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$distro</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">==</span><span class="w"> </span>*<span class="s2">&quot;Red Hat&quot;</span>*<span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">        </span>/usr/bin/echo<span class="w"> </span><span class="s2">&quot;Detected CentOS or RHEL system&quot;</span>
<span class="w">        </span>/usr/bin/sudo<span class="w"> </span>yum<span class="w"> </span>update<span class="w"> </span>-y<span class="w"> </span><span class="m">1</span>&gt;&gt;<span class="nv">$logfile</span><span class="w"> </span><span class="m">2</span>&gt;&gt;<span class="nv">$errorlog</span>
<span class="w">        </span>check_exit_status<span class="w">      </span>
<span class="w">    </span><span class="k">else</span>
<span class="w">        </span>/usr/bin/echo<span class="w"> </span><span class="s2">&quot;Detected unknown Red Hat-based system&quot;</span>
<span class="w">        </span>/usr/bin/sudo<span class="w"> </span>yum<span class="w"> </span>update<span class="w"> </span>-y<span class="w"> </span><span class="m">1</span>&gt;&gt;<span class="nv">$logfile</span><span class="w"> </span><span class="m">2</span>&gt;&gt;<span class="nv">$errorlog</span>
<span class="w">        </span>check_exit_status<span class="w"> </span>
<span class="w">    </span><span class="k">fi</span>
<span class="k">else</span>
<span class="w">    </span>/usr/bin/echo<span class="w"> </span><span class="s2">&quot;Unsupported or unknown Linux distribution&quot;</span>
<span class="k">fi</span>

/usr/bin/echo<span class="w"> </span><span class="s2">&quot;The script completed at: </span><span class="k">$(</span>/usr/bin/date<span class="k">)</span><span class="s2">&quot;</span><span class="w"> </span><span class="m">1</span>&gt;&gt;<span class="nv">$logfile</span><span class="w"> </span><span class="m">2</span>&gt;&gt;<span class="nv">$errorlog</span>
/usr/bin/echo<span class="w"> </span><span class="s2">&quot;-------------------END SCRIPT on </span><span class="nv">$hostname</span><span class="s2">-------------------&quot;</span><span class="w"> </span><span class="m">1</span>&gt;&gt;<span class="nv">$logfile</span><span class="w"> </span><span class="m">2</span>&gt;&gt;<span class="nv">$errorlog</span>
</code></pre></div>
<p>This Bash script performs a distribution-aware system upgrade, logging all output and errors to dedicated log files. It supports Debian/Ubuntu, Fedora, CentOS, and RHEL, and includes error checking after each upgrade step.</p>
<table>
<thead>
<tr>
<th>Line(s)</th>
<th>Purpose</th>
<th>Explanation</th>
</tr>
</thead>
<tbody>
<tr>
<td>#!/bin/bash</td>
<td>Interpreter declaration</td>
<td>Ensures the script runs with Bash</td>
</tr>
<tr>
<td>logfile=/var/log/update_script.log; errorlog=/var/log/update_script_errors.log</td>
<td>Log file setup</td>
<td>Defines paths for standard output and error logs</td>
</tr>
<tr>
<td>echo "START SCRIPT"</td>
<td>Start marker</td>
<td>Logs the beginning of the script execution</td>
</tr>
<tr>
<td>check_exit_status()</td>
<td>Error handler</td>
<td>Function that checks the last command's exit code and prints an error message if non-zero</td>
</tr>
<tr>
<td>if [ -d /etc/apt ]; then</td>
<td>Distro detection</td>
<td>Checks for Debian/Ubuntu by presence of APT directory</td>
</tr>
<tr>
<td>apt update; apt dist-upgrade -y</td>
<td>Debian/Ubuntu upgrade</td>
<td>Runs update and full upgrade, logs output and errors</td>
</tr>
<tr>
<td>elif [ -f /etc/redhat-release ]; then</td>
<td>Red Hat-based detection</td>
<td>Checks for Fedora, CentOS, or RHEL using release file</td>
</tr>
<tr>
<td>cat /etc/redhat-release</td>
<td>Distro name</td>
<td>Reads the release file to identify the specific variant</td>
</tr>
<tr>
<td>dnf upgrade --refresh -y</td>
<td>Fedora upgrade</td>
<td>Refreshes metadata and upgrades packages</td>
</tr>
<tr>
<td>yum update -y</td>
<td>CentOS/RHEL upgrade</td>
<td>Performs system update using yum</td>
</tr>
<tr>
<td>echo "Unsupported distro"</td>
<td>Fallback</td>
<td>Handles unknown or unsupported systems</td>
</tr>
<tr>
<td>echo "Script completed at: $(date)"</td>
<td>Completion timestamp</td>
<td>Logs the end time of the script</td>
</tr>
<tr>
<td>echo "END SCRIPT"</td>
<td>End marker</td>
<td>Logs the conclusion of the script execution</td>
</tr>
</tbody>
</table>
<h4 id="powershell-script-example-windows-update-automation">PowerShell Script Example: Windows Update Automation<a class="headerlink" href="#powershell-script-example-windows-update-automation" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="nv">$ErrorActionPreference</span> <span class="p">=</span> <span class="s2">&quot;Continue&quot;</span>

<span class="c"># Start logging</span>
<span class="nv">$logPath</span> <span class="p">=</span> <span class="s2">&quot;C:\Logs\update_log.txt&quot;</span>
<span class="nb">Start-Transcript</span> <span class="n">-Path</span> <span class="nv">$logPath</span> <span class="n">-Append</span>

<span class="c"># Log header with host and user info</span>
<span class="nv">$hostname</span> <span class="p">=</span> <span class="nv">$env:COMPUTERNAME</span>
<span class="nv">$username</span> <span class="p">=</span> <span class="nv">$env:USERNAME</span>
<span class="nb">Write-Host</span> <span class="s2">&quot;</span><span class="se">`n</span><span class="s2">==================== UPDATE SCRIPT START ====================&quot;</span>
<span class="nb">Write-Host</span> <span class="s2">&quot;Host: $hostname&quot;</span>
<span class="nb">Write-Host</span> <span class="s2">&quot;User: $username&quot;</span>
<span class="nb">Write-Host</span> <span class="s2">&quot;Start Time: </span><span class="p">$(</span><span class="nb">Get-Date</span> <span class="n">-Format</span> <span class="s1">&#39;yyyy-MM-dd HH:mm:ss&#39;</span><span class="p">)</span><span class="s2">&quot;</span>
<span class="nb">Write-Host</span> <span class="s2">&quot;=============================================================</span><span class="se">`n</span><span class="s2">&quot;</span>

<span class="c"># Timestamp helper</span>
<span class="k">function</span> <span class="nb">Write-Timestamped</span> <span class="p">{</span>
    <span class="k">param</span> <span class="p">(</span><span class="no">[string]</span><span class="nv">$message</span><span class="p">)</span>
    <span class="nb">Write-Host</span> <span class="s2">&quot;</span><span class="se">`n</span><span class="s2">[</span><span class="p">$(</span><span class="nb">Get-Date</span> <span class="n">-Format</span> <span class="s1">&#39;yyyy-MM-dd HH:mm:ss&#39;</span><span class="p">)</span><span class="s2">] $message&quot;</span>
<span class="p">}</span>

<span class="c"># Update Windows Store apps</span>
<span class="k">function</span> <span class="nb">Update-WindowsStoreApps</span> <span class="p">{</span>
    <span class="nb">Write-Timestamped</span> <span class="s2">&quot;Starting Windows Store App updates...&quot;</span>
    <span class="nb">Get-CimInstance</span> <span class="n">-Namespace</span> <span class="s2">&quot;Root\cimv2\mdm\dmmap&quot;</span> <span class="n">-ClassName</span> <span class="s2">&quot;MDM_EnterpriseModernAppManagement_AppManagement01&quot;</span> <span class="p">|</span> <span class="nb">Invoke-CimMethod</span> <span class="n">-MethodName</span> <span class="n">UpdateScanMethod</span>
    <span class="nb">Write-Timestamped</span> <span class="s2">&quot;Completed Windows Store App updates.&quot;</span>
<span class="p">}</span>
<span class="nb">Update-WindowsStoreApps</span>

<span class="c"># Update Chocolatey packages</span>
<span class="k">function</span> <span class="nb">Update-ChocoApps</span> <span class="p">{</span>
    <span class="nb">Write-Timestamped</span> <span class="s2">&quot;Checking for Chocolatey...&quot;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">Get-Command</span> <span class="n">choco</span> <span class="n">-ErrorAction</span> <span class="n">SilentlyContinue</span><span class="p">)</span> <span class="p">{</span>
        <span class="nb">Write-Timestamped</span> <span class="s2">&quot;Updating Chocolatey packages...&quot;</span>
        <span class="n">choco</span> <span class="n">upgrade</span> <span class="n">all</span> <span class="n">-y</span>
        <span class="nb">Write-Timestamped</span> <span class="s2">&quot;Completed Chocolatey updates.&quot;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nb">Write-Timestamped</span> <span class="s2">&quot;Chocolatey is not installed. Skipping.&quot;</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="nb">Update-ChocoApps</span>

<span class="c"># Update Winget packages</span>
<span class="k">function</span> <span class="nb">Update-WingetApps</span> <span class="p">{</span>
    <span class="nb">Write-Timestamped</span> <span class="s2">&quot;Checking for Winget...&quot;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">Get-Command</span> <span class="n">winget</span> <span class="n">-ErrorAction</span> <span class="n">SilentlyContinue</span><span class="p">)</span> <span class="p">{</span>
        <span class="nb">Write-Timestamped</span> <span class="s2">&quot;Updating Winget packages...&quot;</span>
        <span class="n">winget</span> <span class="n">upgrade</span> <span class="p">-</span><span class="n">-all</span>
        <span class="nb">Write-Timestamped</span> <span class="s2">&quot;Completed Winget updates.&quot;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nb">Write-Timestamped</span> <span class="s2">&quot;Winget is not installed. Skipping.&quot;</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="nb">Update-WingetApps</span>

<span class="c"># Windows OS Updates</span>
<span class="nb">Write-Timestamped</span> <span class="s2">&quot;Starting Windows OS updates...&quot;</span>
<span class="nb">Import-Module</span> <span class="n">PSWindowsUpdate</span>
<span class="nb">Install-WindowsUpdate</span> <span class="n">-MicrosoftUpdate</span> <span class="n">-AcceptAll</span>
<span class="nb">Write-Timestamped</span> <span class="s2">&quot;Completed Windows OS updates.&quot;</span>

<span class="c"># Log footer</span>
<span class="nb">Write-Host</span> <span class="s2">&quot;</span><span class="se">`n</span><span class="s2">==================== UPDATE SCRIPT END =====================&quot;</span>
<span class="nb">Write-Host</span> <span class="s2">&quot;End Time: </span><span class="p">$(</span><span class="nb">Get-Date</span> <span class="n">-Format</span> <span class="s1">&#39;yyyy-MM-dd HH:mm:ss&#39;</span><span class="p">)</span><span class="s2">&quot;</span>
<span class="nb">Write-Host</span> <span class="s2">&quot;=============================================================&quot;</span>

<span class="c"># End logging</span>
<span class="nb">Stop-Transcript</span>
</code></pre></div>
<p>This script performs a comprehensive update sweep across a Windows system, covering:</p>
<ul>
<li>Windows Store apps</li>
<li>Chocolatey packages</li>
<li>Winget packages</li>
<li>Windows OS updates</li>
</ul>
<p>It logs all output to a transcript file and timestamps each operation for auditability and runtime tracking.</p>
<p><strong>Script:</strong> C:\Scripts\Update-System.ps1</p>
<p><strong>Purpose:</strong> Comprehensive Windows update across multiple package managers</p>
<table>
<thead>
<tr>
<th>Line(s)</th>
<th>Purpose</th>
<th>Explanation</th>
</tr>
</thead>
<tbody>
<tr>
<td>$ErrorActionPreference = "Continue"</td>
<td>Error handling</td>
<td>Ensures the script continues execution even if a command fails</td>
</tr>
<tr>
<td>$logPath = "C:\Logs\update_log.txt"</td>
<td>Log file path</td>
<td>Defines where the transcript will be saved</td>
</tr>
<tr>
<td>Start-Transcript -Path $logPath -Append</td>
<td>Start logging</td>
<td>Begins capturing all console output to the log file</td>
</tr>
<tr>
<td class="..">function Write-Timestamped</td>
<td>Timestamp helper</td>
<td>Prints messages with a timestamp prefix for clarity and tracking</td>
</tr>
<tr>
<td class="..">function Update-WindowsStoreApps</td>
<td>Windows Store updates</td>
<td>Uses CIM to trigger an update scan for Store apps via MDM interface</td>
</tr>
<tr>
<td>Update-WindowsStoreApps</td>
<td>Execute function</td>
<td>Runs the Store app update function</td>
</tr>
<tr>
<td class="..">function Update-ChocoApps</td>
<td>Chocolatey updates</td>
<td>Checks if choco is installed, then upgrades all packages with -y. Logs start, completion, or skip</td>
</tr>
<tr>
<td>Update-ChocoApps</td>
<td>Execute function</td>
<td>Runs the Chocolatey update function</td>
</tr>
<tr>
<td class="..">function Update-WingetApps</td>
<td>Winget updates</td>
<td>Checks if winget is installed, then upgrades all packages. Logs start, completion, or skip</td>
</tr>
<tr>
<td>Update-WingetApps</td>
<td>Execute function</td>
<td>Runs the Winget update function</td>
</tr>
<tr>
<td>Import-Module PSWindowsUpdate</td>
<td>OS update module</td>
<td>Loads the PSWindowsUpdate module for managing Windows updates</td>
</tr>
<tr>
<td>Install-WindowsUpdate -MicrosoftUpdate -AcceptAll</td>
<td>OS updates</td>
<td>Installs all available Microsoft updates silently</td>
</tr>
<tr>
<td>Stop-Transcript</td>
<td>End logging</td>
<td>Stops the transcript and finalizes the log file</td>
</tr>
</tbody>
</table>
<hr />
<h3 id="62-cron-job-scheduling-strategy">6.2 Cron Job Scheduling Strategy<a class="headerlink" href="#62-cron-job-scheduling-strategy" title="Permanent link">&para;</a></h3>
<p>Cron is used extensively across Linux systems to schedule automated tasks at defined intervals, ensuring that maintenance activities, monitoring checks, and data collection occur reliably without manual intervention. Typical cron jobs include nightly backup verification scripts, hourly certificate expiration checks, daily vulnerability scan initiation, periodic log archival and rotation, and regular system health assessments. Cron jobs are documented with inline comments explaining purpose, frequency, and dependencies, and critical jobs send success/failure notifications to the centralized Discord alerting system to ensure failures are promptly identified and addressed.</p>
<p><strong>Webserver Crontab</strong></p>
<table>
<thead>
<tr>
<th>Minute</th>
<th>Hour</th>
<th>Day</th>
<th>Month</th>
<th>Weekday</th>
<th>Command</th>
<th>Description</th>
<th>Last Run Timestamp</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>2</td>
<td>*</td>
<td>*</td>
<td>5</td>
<td>/usr/local/bin/upgrade.sh</td>
<td>Weekly system upgrade</td>
<td>Fri, Nov 1, 2025 02:00 AM</td>
</tr>
<tr>
<td>30</td>
<td>1</td>
<td>*</td>
<td>*</td>
<td>6</td>
<td>/usr/local/bin/backup_web.sh /var/www/lab /backup</td>
<td>Weekly web backup via rsync</td>
<td>Sat, Nov 2, 2025 01:30 AM</td>
</tr>
</tbody>
</table>
<ul>
<li>The first job runs every Friday at 2:00 AM and executes upgrade.sh with no arguments</li>
<li>The second job runs every Saturday at 1:30 AM and executes backup_web.sh with two arguments: /var/www/lab (Source directory) and /backup (Target directory)</li>
</ul>
<hr />
<h3 id="63-python-scripting-for-advanced-automation">6.3 Python Scripting for Advanced Automation<a class="headerlink" href="#63-python-scripting-for-advanced-automation" title="Permanent link">&para;</a></h3>
<p>Python scripts are deployed where more complex logic, data processing, or API interaction is required. Python's extensive library ecosystem makes it ideal for tasks like parsing and correlating log data, interacting with REST APIs for service configuration, processing vulnerability scan results, generating custom reports from multiple data sources, and implementing custom security tools. Python's cross-platform nature allows scripts to run consistently across Windows and Linux systems, and virtual environments ensure dependency isolation and reproducibility.</p>
<h4 id="python-script-example-network-scanner">Python Script Example: Network Scanner<a class="headerlink" href="#python-script-example-network-scanner" title="Permanent link">&para;</a></h4>
<p><div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">sys</span> 
<span class="kn">import</span><span class="w"> </span><span class="nn">socket</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">threading</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">platform</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">subprocess</span>

<span class="c1"># Load common ports from external file</span>
<span class="k">def</span><span class="w"> </span><span class="nf">load_common_ports</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="s1">&#39;common_ports.txt&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Load port mappings from a text file</span>
<span class="sd">    Format: port:service_name (one per line)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ports</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">line</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;#&#39;</span><span class="p">):</span>  <span class="c1"># Skip empty lines and comments</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">port</span><span class="p">,</span> <span class="n">service</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                        <span class="c1"># Strip whitespace and remove quotes/commas</span>
                        <span class="n">service</span> <span class="o">=</span> <span class="n">service</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
                        <span class="n">ports</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">port</span><span class="p">)]</span> <span class="o">=</span> <span class="n">service</span>
                    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Warning: Skipping malformed line: </span><span class="si">{</span><span class="n">line</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ports</span>
    <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Warning: </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s1"> not found. Using empty port dictionary.&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">{}</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Error loading port file: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">{}</span>

<span class="c1"># Load the common ports dictionary</span>
<span class="n">COMMON_PORTS</span> <span class="o">=</span> <span class="n">load_common_ports</span><span class="p">()</span>

<span class="c1"># Global verbose flag</span>
<span class="n">verbose</span> <span class="o">=</span> <span class="kc">False</span>

<span class="k">def</span><span class="w"> </span><span class="nf">ping_host</span><span class="p">(</span><span class="n">target_ip</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Ping the host to check if it&#39;s reachable before scanning</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">param</span> <span class="o">=</span> <span class="s1">&#39;-n&#39;</span> <span class="k">if</span> <span class="n">platform</span><span class="o">.</span><span class="n">system</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;windows&#39;</span> <span class="k">else</span> <span class="s1">&#39;-c&#39;</span>
    <span class="n">command</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;ping&#39;</span><span class="p">,</span> <span class="n">param</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="n">target_ip</span><span class="p">]</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span> <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span><span class="o">.</span><span class="n">returncode</span> <span class="o">==</span> <span class="mi">0</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Ping test failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>

<span class="k">def</span><span class="w"> </span><span class="nf">scan_port</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">port</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function to scan a single port</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span> 
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Scanning port </span><span class="si">{</span><span class="n">port</span><span class="si">}</span><span class="s1">...&#39;</span><span class="p">)</span>

        <span class="n">s</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span>
        <span class="n">s</span><span class="o">.</span><span class="n">settimeout</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">connect_ex</span><span class="p">((</span><span class="n">target</span><span class="p">,</span> <span class="n">port</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">result</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">service_info</span> <span class="o">=</span> <span class="n">COMMON_PORTS</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">port</span><span class="p">,</span> <span class="s2">&quot;Unknown Service&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Port </span><span class="si">{</span><span class="n">port</span><span class="si">}</span><span class="s2"> is open - </span><span class="si">{</span><span class="n">service_info</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">s</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">except</span> <span class="n">socket</span><span class="o">.</span><span class="n">error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Socket error on port </span><span class="si">{</span><span class="n">port</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Unexpected error on port </span><span class="si">{</span><span class="n">port</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
    <span class="k">global</span> <span class="n">verbose</span>

    <span class="c1"># Parse arguments for verbose flag</span>
    <span class="n">args</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Invalid number of arguments.&quot;</span><span class="p">)</span> 
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Usage: python network_scanner.py &lt;target&gt; [-v|--verbose]&quot;</span><span class="p">)</span> 
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">target</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="c1"># Check for verbose flag</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;-v&#39;</span><span class="p">,</span> <span class="s1">&#39;--verbose&#39;</span><span class="p">]:</span>
        <span class="n">verbose</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Verbose mode enabled&quot;</span><span class="p">)</span>

    <span class="c1"># Resolve the target hostname to an IP address</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">target_ip</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">gethostbyname</span><span class="p">(</span><span class="n">target</span><span class="p">)</span> 
    <span class="k">except</span> <span class="n">socket</span><span class="o">.</span><span class="n">gaierror</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Error: Unable to resolve hostname </span><span class="si">{</span><span class="n">target</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># Ping test before scanning</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="mi">50</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Running ping test on </span><span class="si">{</span><span class="n">target_ip</span><span class="si">}</span><span class="s1">...&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ping_host</span><span class="p">(</span><span class="n">target_ip</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Host </span><span class="si">{</span><span class="n">target_ip</span><span class="si">}</span><span class="s1"> is reachable!&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Warning: Host </span><span class="si">{</span><span class="n">target_ip</span><span class="si">}</span><span class="s1"> may be unreachable or blocking ICMP&#39;</span><span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s1">&#39;Continue with scan anyway? (y/n): &#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">!=</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Scan cancelled.&quot;</span><span class="p">)</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="c1"># Add a banner</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="mi">50</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Scanning target </span><span class="si">{</span><span class="n">target_ip</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Time started: </span><span class="si">{</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="mi">50</span><span class="p">)</span>            

    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Use multithreading to scan ports concurrently</span>
        <span class="n">threads</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">port</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">65536</span><span class="p">):</span>
            <span class="n">thread</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">scan_port</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">target_ip</span><span class="p">,</span> <span class="n">port</span><span class="p">))</span>
            <span class="n">threads</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">thread</span><span class="p">)</span>
            <span class="n">thread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

        <span class="c1"># Wait for threads to complete</span>
        <span class="k">for</span> <span class="n">thread</span> <span class="ow">in</span> <span class="n">threads</span><span class="p">:</span>
            <span class="n">thread</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>

    <span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Exiting program.&quot;</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="k">except</span> <span class="n">socket</span><span class="o">.</span><span class="n">error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Socket error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Scan completed!&quot;</span><span class="p">)</span>  
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Time finished: </span><span class="si">{</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</code></pre></div>
<strong>Common Ports txt example:</strong>
<div class="highlight"><pre><span></span><code>20:FTP Data
21:FTP Control
22:SSH
53:DNS/Pi-hole/Bind
67:DHCP Server
68:DHCP Client
80:HTTP
443:HTTPS
445:SMB
2375:Docker Daemon (insecure/TCP)
2376:Docker Daemon (Secure/TLS)
4444:Metasploit
5335:Unbound
5432:PostgreSQL
6379:Redis
7655:Pulse
8001:Elastic Agent
8002:Elastic Agent
8006:Proxmox - PVE
8007:Proxmox - PBS
9000:Authentik/PHP/Netdata
9443:Authentik/Portainer
9090:Prometheus
9200:Elasticsearch
9093:Alert Manager
9094:Alert Manager - Discord
12320:Ansible
12321:Ansible
9115:Blackbox
5000:Checkmk
5050:Checkmk
6060:CrowdSec
8220:ELK Fleet
7990:Heimdall
5601:Kibana
5678:n8n
9392:OpenVAS
5055:Overseer
9617:Pi-Hole Exporter
9001:Portainer Agent
9221:Prometheus PVE Exporter
6443:K3s
3001:Uptime Kuma
1514:Wazuh
1515:Wazuh
</code></pre></div></p>
<p>A custom Python-based network scanner has been developed to provide tailored reconnaissance capabilities specific to the lab environment. The scanner performs several functions:</p>
<ul>
<li><strong>Host Reachability Testing</strong> — Pings target hosts before attempting port scans to verify they are online, reducing wasted scan time and providing quick network inventory validation</li>
<li><strong>Port Scanning</strong> — Uses multi-threaded socket connections to rapidly identify open TCP ports across the full port range (1-65535) or targeted subsets based on scan objectives</li>
<li><strong>Service Identification</strong> — Labels discovered open ports using a custom service mapping file (common_ports.txt) that includes both standard services (SSH, HTTP, HTTPS) and lab-specific applications (Proxmox, Traefik, Authentik). This makes scan results immediately actionable by identifying what application is likely running on each open port</li>
</ul>
<hr />
<h3 id="64-script-integration-and-orchestration">6.4 Script Integration and Orchestration<a class="headerlink" href="#64-script-integration-and-orchestration" title="Permanent link">&para;</a></h3>
<p>Scripts are integrated into broader workflows through several mechanisms. Some scripts are triggered directly by cron jobs for time-based execution. Others are called by monitoring systems in response to alerts or threshold violations (for example, a Grafana alert triggering a remediation script). Ansible playbooks orchestrate multi-step automation by calling shell scripts and Python utilities in sequence, passing parameters and handling error conditions. This layered approach combines the flexibility of custom scripts with the orchestration capabilities of configuration management tools, enabling sophisticated automation scenarios while maintaining maintainability and reusability.</p>
<hr />
<h2 id="7-automation-security-controls">7. Automation Security Controls<a class="headerlink" href="#7-automation-security-controls" title="Permanent link">&para;</a></h2>
<h3 id="control-framework">Control Framework<a class="headerlink" href="#control-framework" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Control Domain</th>
<th>Implementation</th>
<th>Coverage</th>
</tr>
</thead>
<tbody>
<tr>
<td>Secrets Management</td>
<td>Ansible Vault + Vaultwarden</td>
<td>All credentials encrypted</td>
</tr>
<tr>
<td>Access Control</td>
<td>SSH keys only; sudo with NOPASSWD</td>
<td>Ansible service account</td>
</tr>
<tr>
<td>Code Integrity</td>
<td>Git version control with commit signing</td>
<td>All IaC assets</td>
</tr>
<tr>
<td>Privilege Escalation</td>
<td>Least privilege Proxmox service account</td>
<td>Terraform API access</td>
</tr>
<tr>
<td>Input Validation</td>
<td>Regex validation in scripts</td>
<td>Prevents injection attacks</td>
</tr>
<tr>
<td>Audit Logging</td>
<td>Syslog + Git commits + n8n execution logs</td>
<td>Full audit trail</td>
</tr>
<tr>
<td>Change Management</td>
<td>Git</td>
<td>Controlled deployments</td>
</tr>
<tr>
<td>Backup &amp; Recovery</td>
<td>GitHub + NAS + PBS</td>
<td>Multiple restore points</td>
</tr>
</tbody>
</table>
<h3 id="authentication-authorization_1">Authentication &amp; Authorization<a class="headerlink" href="#authentication-authorization_1" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Technology</th>
<th>Authentication Method</th>
<th>Authorization Scope</th>
</tr>
</thead>
<tbody>
<tr>
<td>Terraform</td>
<td>Proxmox API token (non-password)</td>
<td>VM/LXC provisioning only</td>
</tr>
<tr>
<td>Ansible</td>
<td>SSH key (ed25519; passphrase)</td>
<td>sudo NOPASSWD on managed hosts</td>
</tr>
<tr>
<td>n8n</td>
<td>Authentik SSO (OAuth2)</td>
<td>Workflow admin access</td>
</tr>
<tr>
<td>GitHub</td>
<td>Personal access token (PAT)</td>
<td>Repository push/pull</td>
</tr>
<tr>
<td>Scripts</td>
<td>User context (ansible/root)</td>
<td>File system and service control</td>
</tr>
</tbody>
</table>
<h3 id="secrets-protection">Secrets Protection<a class="headerlink" href="#secrets-protection" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Secret Type</th>
<th>Storage Location</th>
<th>Encryption Method</th>
</tr>
</thead>
<tbody>
<tr>
<td>Terraform API tokens</td>
<td>terraform.tfvars (gitignored)</td>
<td>File permissions 0600</td>
</tr>
<tr>
<td>Ansible passwords</td>
<td>ansible-vault encrypted files</td>
<td>AES-256 with master key</td>
</tr>
<tr>
<td>n8n credentials</td>
<td>Vaultwarden database</td>
<td>Application-level encryption</td>
</tr>
<tr>
<td>SSH private keys</td>
<td>~/.ssh/ with 0600 perms</td>
<td>Passphrase-protected</td>
</tr>
<tr>
<td>Script API tokens</td>
<td>Environment variables</td>
<td>Not persisted to disk</td>
</tr>
</tbody>
</table>
<h3 id="audit-trail-components">Audit Trail Components<a class="headerlink" href="#audit-trail-components" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Event Type</th>
<th>Logging Mechanism</th>
<th>Retention</th>
</tr>
</thead>
<tbody>
<tr>
<td>Git Commits</td>
<td>GitHub repository</td>
<td>Indefinite</td>
</tr>
<tr>
<td>Terraform Apply</td>
<td>Local state file + stdout log</td>
<td>90 days</td>
</tr>
<tr>
<td>Ansible Playbook Runs</td>
<td>Ansible log + syslog</td>
<td>90 days</td>
</tr>
<tr>
<td>n8n Workflow Executions</td>
<td>PostgreSQL + execution history</td>
<td>30 days</td>
</tr>
<tr>
<td>Script Executions</td>
<td>Syslog + individual log files</td>
<td>30 days</td>
</tr>
<tr>
<td>Cron Job Runs</td>
<td>/var/log/cron + job-specific logs</td>
<td>30 days</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="9-practical-use-cases-and-workflows">9. Practical Use Cases and Workflows<a class="headerlink" href="#9-practical-use-cases-and-workflows" title="Permanent link">&para;</a></h2>
<h3 id="scenario-1-new-vm-provisioning">Scenario 1: New VM Provisioning<a class="headerlink" href="#scenario-1-new-vm-provisioning" title="Permanent link">&para;</a></h3>
<p><strong>Objective:</strong> Deploy new Docker host in &lt;5 minutes</p>
<p><strong>Workflow:</strong></p>
<ul>
<li>Developer updates Terraform variables:</li>
<li>hostname: docker-vm-03</li>
<li>vmid: 203</li>
<li>Run Terraform:</li>
<li>cd terraform/vm</li>
<li>terraform apply -var="hostname=docker-vm-03" -var="vmid=203" -auto-approve</li>
<li>Terraform clones ubuntu-cloud template, provisions VM</li>
<li>Output displays IP address: 192.168.100.203</li>
<li>Run Ansible bootstrap:</li>
<li>ansible-playbook -i hosts.yml new_install.yaml --limit docker-vm-03.home.com</li>
<li>Ansible configures SSH, creates ansible user, installs packages</li>
<li>VM ready for application deployment</li>
</ul>
<p><strong>Result:</strong> Consistent, reproducible VM provisioning with full audit trail</p>
<hr />
<h3 id="scenario-2-weekly-security-update-cycle">Scenario 2: Weekly Security Update Cycle<a class="headerlink" href="#scenario-2-weekly-security-update-cycle" title="Permanent link">&para;</a></h3>
<p><strong>Objective:</strong> Keep all systems patched without manual intervention</p>
<p><strong>Workflow:</strong></p>
<ul>
<li>Saturday 2 AM: n8n workflow triggers</li>
<li>n8n executes SSH command on Ansible controller</li>
<li>Ansible playbook runs across all Linux hosts:</li>
<li>Debian/Ubuntu: apt update &amp;&amp; apt upgrade -y</li>
<li>RHEL/Fedora: dnf update -y</li>
<li>Playbook output converted to JSON</li>
<li>JSON uploaded to GitHub (audit trail)</li>
<li>Discord notification sent with summary:</li>
<li>23/25 hosts updated successfully</li>
<li>2 hosts require reboot</li>
<li>Admin reviews notification and schedules reboots if needed</li>
</ul>
<p><strong>Result:</strong> Automated patch management with centralized reporting and alerting</p>
<hr />
<h3 id="scenario-3-rapid-disaster-recovery">Scenario 3: Rapid Disaster Recovery<a class="headerlink" href="#scenario-3-rapid-disaster-recovery" title="Permanent link">&para;</a></h3>
<p><strong>Objective:</strong> Rebuild compromised VM from code</p>
<p><strong>Workflow:</strong></p>
<ul>
<li>Incident detected: VM compromised via vulnerability</li>
<li>Admin destroys compromised VM:</li>
<li>terraform destroy -var="vmid=205"</li>
<li>Review Git history to find last known-good configuration:</li>
<li>git log terraform/vm/main.tf</li>
<li>Checkout previous commit if needed:</li>
<li>git checkout abc123def terraform/vm/main.tf</li>
<li>Rebuild VM with Terraform:</li>
<li>terraform apply -var="hostname=web-vm-01" -var="vmid=205"</li>
<li>Re-run Ansible playbooks to restore configuration:</li>
<li>ansible-playbook -i hosts.yml site.yml --limit web-vm-01.home.com</li>
<li>Restore application data from NAS backup</li>
<li>VM back online with clean configuration</li>
</ul>
<p><strong>Result:</strong> Complete rebuild in &lt;30 minutes vs. hours of manual work</p>
<hr />
<h3 id="scenario-4-threat-intelligence-distribution">Scenario 4: Threat Intelligence Distribution<a class="headerlink" href="#scenario-4-threat-intelligence-distribution" title="Permanent link">&para;</a></h3>
<p><strong>Objective:</strong> Daily security awareness for lab operations</p>
<p><strong>Workflow:</strong></p>
<ul>
<li>Daily 8 AM: n8n workflow executes</li>
<li>RSS feeds polled from multiple cybersecurity sources</li>
<li>Each feed limited to 5 most recent entries</li>
<li>NIST feed sent to ChatGPT for AI summarization</li>
<li>Aggregated digest posted to Discord #threat-intel channel</li>
</ul>
<p><strong>Result:</strong> Consolidated threat intelligence reduces information overload</p>
<hr />
<h3 id="scenario-5-configuration-drift-detection">Scenario 5: Configuration Drift Detection<a class="headerlink" href="#scenario-5-configuration-drift-detection" title="Permanent link">&para;</a></h3>
<p><strong>Objective:</strong> Ensure compliance with security baseline</p>
<p><strong>Workflow:</strong></p>
<ul>
<li>Weekly: n8n triggers Ansible audit playbook</li>
<li>Playbook gathers configuration from all hosts:</li>
<li>SSH config settings</li>
<li>Firewall rules</li>
<li>Installed packages</li>
<li>User accounts</li>
<li>DNS configuration</li>
<li>Output compared against baseline in Git</li>
<li>Drift detected on 2 hosts (unauthorized package installed)</li>
<li>Discord alert sent with details</li>
</ul>
<p><strong>Result:</strong> Proactive detection of configuration drift and unauthorized changes</p>
<hr />
<h2 id="11-security-homelab-section-links">11. Security Homelab Section Links<a class="headerlink" href="#11-security-homelab-section-links" title="Permanent link">&para;</a></h2>
<ul>
<li><strong><a href="/Career_Projects/projects/homelab/01-exec-summary/">Executive Summary and Security Posture</a></strong></li>
<li><strong><a href="/Career_Projects/projects/homelab/02-platform/">Infrastructure Platform, Virtualization Stack and Hardware</a></strong> </li>
<li><strong><a href="/Career_Projects/projects/homelab/03-network/">Network Security, Privacy and Remote Access</a></strong> </li>
<li><strong><a href="/Career_Projects/projects/homelab/04-iam-secrets/">Identity, Access, Secrets and Trust Management</a></strong> </li>
<li><strong><a href="/Career_Projects/projects/homelab/05-auto-iac/">Automation and IaC</a></strong></li>
<li><strong><a href="/Career_Projects/projects/homelab/06-apps-service/">Applications and Services</a></strong></li>
<li><strong><a href="/Career_Projects/projects/homelab/07-vis-response-pt1/">Observability and Response, Part 1</a></strong></li>
<li><strong><a href="/Career_Projects/projects/homelab/08-vis-response-pt2/">Observability and Response, Part 2</a></strong></li>
</ul>












                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../../..", "features": ["navigation.instant", "navigation.sections", "navigation.expand", "content.code.copy", "content.tabs.link", "toc.follow", "toc.integrate"], "search": "../../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../assets/javascripts/bundle.79ae519e.min.js"></script>
      
    
  </body>
</html>